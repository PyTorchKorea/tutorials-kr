
<!DOCTYPE html>


<html lang="ko" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="article:modified_time" content="2022-11-30T07:09:41+00:00" /><meta property="og:title" content="PyTorch를 이용한 뉴럴 변환(Neural Transfer)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tutorials.pytorch.kr/advanced/neural_style_tutorial.html" />
<meta property="og:site_name" content="PyTorch Tutorials KR" />
<meta property="og:description" content="Author: Alexis Jacq Edited by: Winston Herring 번역: 정재민 소개: 이번 튜토리얼은 Leon A. Gatys, Alexander S. Ecker and Matthias Bethge에 의해 개발된 뉴럴 스타일(Neural-Style) 알고리즘 을 구현하는 방법에 대하여 설명합니다. 뉴럴 스타일(Neural-Style), 또는 뉴럴 변환(Neural-Transfer)을 사용하면 이미지를 새로운 예술적 스타일로 재현할 수 있습니다. 이 알고리즘은 입력 이미지, Content 이미지, Style ..." />
<meta property="og:image" content="https://tutorials.pytorch.kr/_static/logos/logo-kr-sm-dark.png" />
<meta property="og:image:alt" content="PyTorch Tutorials KR" />
<meta name="description" content="Author: Alexis Jacq Edited by: Winston Herring 번역: 정재민 소개: 이번 튜토리얼은 Leon A. Gatys, Alexander S. Ecker and Matthias Bethge에 의해 개발된 뉴럴 스타일(Neural-Style) 알고리즘 을 구현하는 방법에 대하여 설명합니다. 뉴럴 스타일(Neural-Style), 또는 뉴럴 변환(Neural-Transfer)을 사용하면 이미지를 새로운 예술적 스타일로 재현할 수 있습니다. 이 알고리즘은 입력 이미지, Content 이미지, Style ..." />
<meta property="og:ignore_canonical" content="true" />

    <title>PyTorch를 이용한 뉴럴 변환(Neural Transfer) &#8212; 파이토치 한국어 튜토리얼 (PyTorch tutorials in Korean)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=536c50fe" />
    <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=4d2595e5" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pytorch_theme.css?v=c326296f" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=097efa9c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom2.css?v=b169ea90" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=725a5b95"></script>
    <script src="../_static/doctools.js?v=92e14aea"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/translations.js?v=b5f768d8"></script>
    <script src="../_static/katex.min.js?v=be8ff15f"></script>
    <script src="../_static/auto-render.min.js?v=ad136472"></script>
    <script src="../_static/katex_autorenderer.js?v=bebc588a"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'advanced/neural_style_tutorial';</script>
    <link rel="canonical" href="https://tutorials.pytorch.kr/advanced/neural_style_tutorial.html" />
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="색인" href="../genindex.html" />
    <link rel="search" title="검색" href="../search.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ko"/>
    <meta name="docbuild:last-update" content="2022년 11월 30일"/>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js"></script>
<script>
  if (window.location.hostname === 'docs.pytorch.org' || window.location.hostname === 'docs-preview.pytorch.org') {
    const script = document.createElement('script');
    script.src = 'https://cmp.osano.com/16A0DbT9yDNIaQkvZ/31b1b91a-e0b6-47ea-bde2-7f2bd13dbe5c/osano.js?variant=one';
    document.head.appendChild(script);
  }
</script>
<script>
  // Cookie banner for non-LF projects
  document.addEventListener('DOMContentLoaded', function () {
    // Hide cookie banner on local environments and LF owned docs
    if (window.location.hostname === 'localhost' ||
      window.location.hostname === '0.0.0.0' ||
      window.location.hostname === '127.0.0.1' ||
      window.location.hostname === 'docs.pytorch.org' ||
      window.location.hostname === 'docs-preview.pytorch.org' ||
      window.location.hostname.startsWith('192.168.')) {
      const banner = document.querySelector('.cookie-banner-wrapper');
      if (banner) {
        banner.style.display = 'none';
      }
    }
  });
</script>
<!-- Conditional CSS for header and footer height adjustment -->

<link rel="stylesheet" type="text/css" href="../_static/css/theme.css" crossorigin="anonymous">
<script type="text/javascript" src="../_static/js/theme.js"></script>
<script type="text/javascript" src="../_static/js/dropdown-menu.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&family=Nanum+Gothic+Coding:wght@400;700&family=Montserrat:wght@300;400&display=swap" rel="stylesheet">
<meta property="og:image" content="../_static/img/pytorch_seo.png" />
<link rel="stylesheet" href="../_static/webfonts/all.min.css" crossorigin="anonymous">
<meta http-equiv="Content-Security-Policy"
  content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval' blob:;">
<meta name="pytorch_project" content="tutorials">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-LZRD6GXDLF" height="0" width="0"
    style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<!-- Google Tag Manager -->
<script>(function (w, d, s, l, i) {
    w[l] = w[l] || []; w[l].push({
      'gtm.start':
        new Date().getTime(), event: 'gtm.js'
    }); var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
        'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    j.onload = function () {
      window.dispatchEvent(new Event('gtm_loaded'));
      console.log('GTM loaded successfully');
    };
  })(window, document, 'script', 'dataLayer', 'G-LZRD6GXDLF');
</script>
<!-- End Google Tag Manager -->
<!-- Facebook Pixel Code -->
<script>
  !function (f, b, e, v, n, t, s) {
    if (f.fbq) return; n = f.fbq = function () {
      n.callMethod ?
        n.callMethod.apply(n, arguments) : n.queue.push(arguments)
    };
    if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
    n.queue = []; t = b.createElement(e); t.async = !0;
    t.src = v; s = b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t, s)
  }(window, document, 'script',
    'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '243028289693773');
  fbq('track', 'PageView');
</script>
<script>
  document.documentElement.setAttribute('data-version', 'v2.8.0+cu128');
</script>
<noscript>
  <img height="1" width="1" src="https://www.facebook.com/tr?id=243028289693773&ev=PageView&noscript=1" />
</noscript>
<script>
  function gtag() {
    window.dataLayer.push(arguments);
  }
</script>
<!-- End Facebook Pixel Code -->
<!-- Script to Fix scrolling -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Fix anchor scrolling
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);

        if (targetElement) {
          const headerHeight =
            (document.querySelector('.header-holder') ? document.querySelector('.header-holder').offsetHeight : 0) +
            (document.querySelector('.bd-header') ? document.querySelector('.bd-header').offsetHeight : 0) + 20;

          const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - headerHeight;
          window.scrollTo({
            top: targetPosition,
            behavior: 'smooth'
          });

          // Update URL hash without scrolling
          history.pushState(null, null, '#' + targetId);
        }
      });
    });
  });
</script>

<script async src="https://cse.google.com/cse.js?cx=e65585f8c3ea1440e"></script>


  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ko"/>
    <meta name="docbuild:last-update" content="2022년 11월 30일"/>

  </head>

<body data-feedback-url="https://github.com/PyTorchKorea/tutorials-kr" class="pytorch-body">
  
    <div class="container-fluid header-holder tutorials-header" id="header-holder">
   <div class="header-container-wrapper">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.kr/" aria-label="PyTorchKR"></a>

      <div class="main-menu">
        <ul>

          <li class="main-menu-item">
          <div id="learnDropdownButton" data-toggle="learn-dropdown" class="learn-dropdown">
              <a class="with-down-arrow">
                <span>배우기</span>
              </a>
              <div class="learn-dropdown-menu dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.kr/get-started/locally/">
                  <span class="dropdown-title">PyTorch 시작하기</span>
                </a>
                <a class="nav-dropdown-item" href="https://tutorials.pytorch.kr/beginner/basics/intro.html">
                  <span class="dropdown-title">기본 익히기</span>
                </a>
                <a class="nav-dropdown-item" href="https://tutorials.pytorch.kr/" target="_self">
                  <span class="dropdown-title">한국어 튜토리얼</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.kr/hub/">
                  <span class="dropdown-title">한국어 모델 허브</span>
                </a>
                <a class="nav-dropdown-item" href="https://docs.pytorch.org/tutorials/" target="_blank">
                  <span class="dropdown-title">Official Tutorials</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <a href="https://pytorch.kr/blog/">
              <span>블로그</span>
            </a>
          </li>

          <li class="main-menu-item">
          <div id="docsDropdownButton" data-toggle="docs-dropdown" class="docs-dropdown">
              <a class="with-down-arrow">
              <span>문서</span>
              </a>
              <div class="docs-dropdown-menu dropdown-menu">
                <a class="nav-dropdown-item" href="https://docs.pytorch.org/docs/" target="_blank">
                  <span class="dropdown-title">PyTorch API</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.kr/domains/">
                  <span class="dropdown-title">Domain API 소개</span>
                </a>
                <a class="nav-dropdown-item" href="https://tutorials.pytorch.kr/" target="_self">
                  <span class="dropdown-title">한국어 튜토리얼</span>
                </a>
                <a class="nav-dropdown-item" href="https://docs.pytorch.org/tutorials/" target="_blank">
                  <span class="dropdown-title">Official Tutorials</span>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
          <div id="communityDropdownButton" data-toggle="community-dropdown" class="community-dropdown">
              <a class="with-down-arrow">
              <span>커뮤니티</span>
              </a>
              <div class="community-dropdown-menu dropdown-menu">
                <a class="nav-dropdown-item" href="https://discuss.pytorch.kr/" target="_self">
                  <span class="dropdown-title">한국어 커뮤니티</span>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.kr/resources/">
                  <span class="dropdown-title">개발자 정보</span>
                </a>
                <a class="nav-dropdown-item" href="https://landscape.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Landscape</span>
                </a>
              </div>
            </div>
          </li>

        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu">
        <i class="fa-solid fa-ellipsis"></i>
      </a>
    </div>
  </div>
 </div>

 <!-- Begin Mobile Menu -->

<div class="mobile-main-menu">
  <div class="container-fluid">
    <div class="header-container-wrapper">
      <div class="mobile-main-menu-header-container">
        <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu">
          <i class="fa-solid fa-xmark"></i>
        </a>
      </div>
    </div>
  </div>

  <div class="mobile-main-menu-links-container">
    <div class="main-menu">
      <ul>
         <li class="resources-mobile-menu-title">
           <a>배우기</a>
         </li>
         <ul class="resources-mobile-menu-items">
           <li>
             <a href="https://pytorch.kr/get-started/locally/">PyTorch 시작하기</a>
           </li>
           <li>
             <a href="https://tutorials.pytorch.kr/beginner/basics/intro.html">기본 익히기</a>
           </li>
           <li>
             <a href="https://tutorials.pytorch.kr/">한국어 튜토리얼</a>
           </li>
           <li>
             <a href="https://pytorch.kr/hub/">한국어 모델 허브</a>
           </li>
           <li>
             <a href="https://docs.pytorch.org/tutorials/" target="_blank">Official Tutorials</a>
           </li>
        </ul>
         <li class="resources-mobile-menu-title">
           <a href="https://pytorch.kr/blog/">블로그</a>
         </li>
         <li class="resources-mobile-menu-title">
           <a>문서</a>
         </li>
         <ul class="resources-mobile-menu-items">
          <li>
            <a href="https://docs.pytorch.org/docs/" target="_blank">PyTorch API</a>
          </li>
          <li>
            <a href="https://pytorch.kr/domains/">Domain API 소개</a>
          </li>
          <li>
            <a href="https://tutorials.pytorch.kr/">한국어 튜토리얼</a>
          </li>
          <li>
            <a href="https://docs.pytorch.org/tutorials/" target="_blank">Official Tutorials</a>
          </li>
        </ul>
        <li class="resources-mobile-menu-title">
          <a>커뮤니티</a>
        </li>
         <ul class="resources-mobile-menu-items">
          <li>
            <a href="https://discuss.pytorch.kr/">한국어 커뮤니티</a>
          </li>
          <li>
            <a href="https://pytorch.kr/resources/">개발자 정보</a>
          </li>
          <li>
            <a href="https://landscape.pytorch.org/" target="_blank">Landscape</a>
          </li>
        </ul>
      </ul>
    </div>
  </div>
</div>

<!-- End Mobile Menu -->
  
  
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">
  <a href="../index.html" class="version">v2.8.0+cu128</a>
</div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../intro.html">
    Intro
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../compilers_index.html">
    Compilers
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../domains.html">
    Domains
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../distributed.html">
    Distributed
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../deep-dive.html">
    Deep Dive
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../extension.html">
    Extension
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../ecosystem.html">
    Ecosystem
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../recipes_index.html">
    Recipes
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">
<div class="search-container-wrapper">
  <div id="sphinx-search" class="search-container">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </div>

  <div id="google-search" class="search-container" style="display:none;">
    <div class="gcse-search-wrapper">
      <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
      <div class="gcse-search"></div>
    </div>
  </div>

  <div class="search-toggle-container" data-bs-title="Google Search Off" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <div class="search-toggle-inner">
      <label class="switch">
        <input type="checkbox" id="search-toggle">
        <span class="slider round"></span>
      </label>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
  // Define the search callback
  const myWebSearchStartingCallback = (gname, query) => {
    if (typeof dataLayer !== 'undefined' && query) {
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        'event': 'google_search',
        'search_term': query,
        'event_category': 'Search',
        'event_label': 'Google Search'
      });
    }
    return '';
  };

  // Set up the GCSE search callbacks
  window.__gcse || (window.__gcse = {});
  window.__gcse.searchCallbacks = {
    web: { starting: myWebSearchStartingCallback }
  };

  if (window.location.pathname.includes('/search.html')) {
    document.body.classList.add('search-page');
  }

  // Function to reinitialize Google CSE
  function reinitializeGoogleSearch() {
    if (window.__gcse && window.__gcse.initializationCallback) {
      window.__gcse.initializationCallback();
    }
  }

  // Function to handle search toggle
  function handleSearchToggle(toggle, sphinxSearch, googleSearch) {
    if (!toggle || !sphinxSearch || !googleSearch) return;

    // Check if the URL contains /stable/ or /tutorials/
    const currentUrl = window.location.href;
    // TODO: We've had reports that the google programmable search is returning stale documentation,
    //       Simple reproduction is to turn google search on and search for multinomial which will
    //       result in returning 1.8.1 documentation.
    //       We should turn this back on when we resolve that bug.
    const shouldDefaultToGoogle = false;
    const savedPreference = localStorage.getItem('searchPreference');

    // Set initial state
    if (savedPreference === 'google' || (savedPreference === null && shouldDefaultToGoogle)) {
      toggle.checked = true;
      sphinxSearch.style.display = 'none';
      googleSearch.style.display = 'block';
      if (savedPreference === null) {
        localStorage.setItem('searchPreference', 'google');
      }
      reinitializeGoogleSearch();
    } else {
      toggle.checked = false;
      sphinxSearch.style.display = 'block';
      googleSearch.style.display = 'none';
    }

    // Update tooltip
    updateTooltip(toggle.checked);

    // Skip if already initialized
    if (toggle.hasAttribute('data-initialized')) return;
    toggle.setAttribute('data-initialized', 'true');

    toggle.addEventListener('change', function() {
      if (this.checked) {
        sphinxSearch.style.display = 'none';
        googleSearch.style.display = 'block';
        localStorage.setItem('searchPreference', 'google');
        reinitializeGoogleSearch();
        trackSearchEngineSwitch('Google');
      } else {
        sphinxSearch.style.display = 'block';
        googleSearch.style.display = 'none';
        localStorage.setItem('searchPreference', 'sphinx');
        trackSearchEngineSwitch('Sphinx');
      }

      updateTooltip(this.checked);
      updateMobileSearch();
    });
  }

  // Update tooltip based on toggle state
  function updateTooltip(isChecked) {
    const tooltipElement = document.querySelector('.search-toggle-container');
    if (!tooltipElement) return;

    tooltipElement.setAttribute('data-bs-title', isChecked ? 'Google Search On' : 'Google Search Off');

    if (bootstrap && bootstrap.Tooltip) {
      const tooltipInstance = bootstrap.Tooltip.getInstance(tooltipElement);
      if (tooltipInstance) tooltipInstance.dispose();
      new bootstrap.Tooltip(tooltipElement);
    }
  }

  // Track search engine switch
  function trackSearchEngineSwitch(engine) {
    if (typeof dataLayer !== 'undefined') {
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        'event': 'search_engine_switch',
        'event_category': 'Search',
        'event_label': engine
      });
    }
  }

  // Function to update mobile search based on current toggle state
  function updateMobileSearch() {
    const toggle = document.getElementById('search-toggle');
    if (!toggle) return;

    const mobileSearchContainer = document.querySelector('.sidebar-header-items__end .navbar-item .search-container-wrapper');
    if (!mobileSearchContainer) return;

    const mobileSphinxSearch = mobileSearchContainer.querySelector('#sphinx-search');
    const mobileGoogleSearch = mobileSearchContainer.querySelector('#google-search');

    if (mobileSphinxSearch && mobileGoogleSearch) {
      mobileSphinxSearch.style.display = toggle.checked ? 'none' : 'block';
      mobileGoogleSearch.style.display = toggle.checked ? 'block' : 'none';

      if (toggle.checked) {
        reinitializeGoogleSearch();
      }
    }
  }

  // Initialize desktop search toggle
  const toggle = document.getElementById('search-toggle');
  const sphinxSearch = document.getElementById('sphinx-search');
  const googleSearch = document.getElementById('google-search');
  handleSearchToggle(toggle, sphinxSearch, googleSearch);

  // Set placeholder text for Google search input
  const observer = new MutationObserver(function() {
    document.querySelectorAll('.gsc-input input').forEach(input => {
      if (input && !input.hasAttribute('data-placeholder-set')) {
        input.setAttribute('placeholder', 'Search the docs ...');
        input.setAttribute('data-placeholder-set', 'true');
      }
    });
  });

  observer.observe(document.body, { childList: true, subtree: true });

  // Fix for scroll jump issue - improved approach
  function setupSearchInputHandlers(input) {
    if (input.hasAttribute('data-scroll-fixed')) return;
    input.setAttribute('data-scroll-fixed', 'true');

    let lastScrollPosition = 0;
    let isTyping = false;
    let scrollTimeout;

    // Save position before typing starts
    input.addEventListener('keydown', () => {
      lastScrollPosition = window.scrollY;
      isTyping = true;

      // Reset typing state after a short delay
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        isTyping = false;
      }, 100);
    });

    // Only maintain scroll position during typing
    function maintainScroll() {
      if (document.activeElement === input && isTyping) {
        window.scrollTo(0, lastScrollPosition);
        requestAnimationFrame(maintainScroll);
      }
    }

    input.addEventListener('focus', () => {
      // Just store initial position but don't force it
      lastScrollPosition = window.scrollY;
    });

    input.addEventListener('input', () => {
      isTyping = true;
      window.scrollTo(0, lastScrollPosition);

      // Reset typing state after a short delay
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        isTyping = false;
      }, 100);

      requestAnimationFrame(maintainScroll);
    });
  }

  // Apply to all search inputs and observe for new ones
  function applyToSearchInputs() {
    document.querySelectorAll('.search-container input, .gsc-input input').forEach(setupSearchInputHandlers);
  }

  applyToSearchInputs();

  const searchObserver = new MutationObserver(applyToSearchInputs);
  searchObserver.observe(document.body, { childList: true, subtree: true });

  // Watch for mobile menu creation
  const mobileMenuObserver = new MutationObserver(function(mutations) {
    for (const mutation of mutations) {
      if (!mutation.addedNodes.length) continue;

      // Style mobile search inputs
      document.querySelectorAll('.sidebar-header-items__end .navbar-item .search-container-wrapper .gsc-input input').forEach(input => {
        if (input) {
          input.setAttribute('placeholder', 'Search the docs ...');
          input.style.paddingLeft = '36px';
        }
      });

      // Check for mobile search container
      const mobileSearchContainer = document.querySelector('.sidebar-header-items__end .navbar-item .search-container-wrapper');
      if (!mobileSearchContainer) continue;

      const mobileToggle = mobileSearchContainer.querySelector('#search-toggle');
      if (mobileToggle && toggle) {
        // Sync mobile toggle with desktop toggle
        mobileToggle.checked = toggle.checked;
        updateMobileSearch();

        // Add event listener to mobile toggle if not already added
        if (!mobileToggle.hasAttribute('data-initialized')) {
          mobileToggle.setAttribute('data-initialized', 'true');
          mobileToggle.addEventListener('change', function() {
            // Sync desktop toggle with mobile toggle
            toggle.checked = this.checked;
            // Trigger change event on desktop toggle to update both
            toggle.dispatchEvent(new Event('change'));
          });
        }
      }
    }
  });

  mobileMenuObserver.observe(document.body, { childList: true, subtree: true });

  // Ensure Google CSE is properly loaded
  if (window.__gcse) {
    window.__gcse.callback = function() {
      // This will run after Google CSE is fully loaded
      if (toggle && toggle.checked) {
        reinitializeGoogleSearch();
      }
    };
  } else {
    window.__gcse = {
      callback: function() {
        if (toggle && toggle.checked) {
          reinitializeGoogleSearch();
        }
      }
    };
  }
});
</script>
</div>
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PyTorchKorea/tutorials-kr" title="한국어 튜토리얼 GitHub 저장소" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">한국어 튜토리얼 GitHub 저장소</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discuss.pytorch.kr/" title="파이토치 한국어 커뮤니티" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">파이토치 한국어 커뮤니티</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../intro.html">
    Intro
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../compilers_index.html">
    Compilers
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../domains.html">
    Domains
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../distributed.html">
    Distributed
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../deep-dive.html">
    Deep Dive
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../extension.html">
    Extension
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../ecosystem.html">
    Ecosystem
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../recipes_index.html">
    Recipes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="search-container-wrapper">
  <div id="sphinx-search" class="search-container">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </div>

  <div id="google-search" class="search-container" style="display:none;">
    <div class="gcse-search-wrapper">
      <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
      <div class="gcse-search"></div>
    </div>
  </div>

  <div class="search-toggle-container" data-bs-title="Google Search Off" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <div class="search-toggle-inner">
      <label class="switch">
        <input type="checkbox" id="search-toggle">
        <span class="slider round"></span>
      </label>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
  // Define the search callback
  const myWebSearchStartingCallback = (gname, query) => {
    if (typeof dataLayer !== 'undefined' && query) {
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        'event': 'google_search',
        'search_term': query,
        'event_category': 'Search',
        'event_label': 'Google Search'
      });
    }
    return '';
  };

  // Set up the GCSE search callbacks
  window.__gcse || (window.__gcse = {});
  window.__gcse.searchCallbacks = {
    web: { starting: myWebSearchStartingCallback }
  };

  if (window.location.pathname.includes('/search.html')) {
    document.body.classList.add('search-page');
  }

  // Function to reinitialize Google CSE
  function reinitializeGoogleSearch() {
    if (window.__gcse && window.__gcse.initializationCallback) {
      window.__gcse.initializationCallback();
    }
  }

  // Function to handle search toggle
  function handleSearchToggle(toggle, sphinxSearch, googleSearch) {
    if (!toggle || !sphinxSearch || !googleSearch) return;

    // Check if the URL contains /stable/ or /tutorials/
    const currentUrl = window.location.href;
    // TODO: We've had reports that the google programmable search is returning stale documentation,
    //       Simple reproduction is to turn google search on and search for multinomial which will
    //       result in returning 1.8.1 documentation.
    //       We should turn this back on when we resolve that bug.
    const shouldDefaultToGoogle = false;
    const savedPreference = localStorage.getItem('searchPreference');

    // Set initial state
    if (savedPreference === 'google' || (savedPreference === null && shouldDefaultToGoogle)) {
      toggle.checked = true;
      sphinxSearch.style.display = 'none';
      googleSearch.style.display = 'block';
      if (savedPreference === null) {
        localStorage.setItem('searchPreference', 'google');
      }
      reinitializeGoogleSearch();
    } else {
      toggle.checked = false;
      sphinxSearch.style.display = 'block';
      googleSearch.style.display = 'none';
    }

    // Update tooltip
    updateTooltip(toggle.checked);

    // Skip if already initialized
    if (toggle.hasAttribute('data-initialized')) return;
    toggle.setAttribute('data-initialized', 'true');

    toggle.addEventListener('change', function() {
      if (this.checked) {
        sphinxSearch.style.display = 'none';
        googleSearch.style.display = 'block';
        localStorage.setItem('searchPreference', 'google');
        reinitializeGoogleSearch();
        trackSearchEngineSwitch('Google');
      } else {
        sphinxSearch.style.display = 'block';
        googleSearch.style.display = 'none';
        localStorage.setItem('searchPreference', 'sphinx');
        trackSearchEngineSwitch('Sphinx');
      }

      updateTooltip(this.checked);
      updateMobileSearch();
    });
  }

  // Update tooltip based on toggle state
  function updateTooltip(isChecked) {
    const tooltipElement = document.querySelector('.search-toggle-container');
    if (!tooltipElement) return;

    tooltipElement.setAttribute('data-bs-title', isChecked ? 'Google Search On' : 'Google Search Off');

    if (bootstrap && bootstrap.Tooltip) {
      const tooltipInstance = bootstrap.Tooltip.getInstance(tooltipElement);
      if (tooltipInstance) tooltipInstance.dispose();
      new bootstrap.Tooltip(tooltipElement);
    }
  }

  // Track search engine switch
  function trackSearchEngineSwitch(engine) {
    if (typeof dataLayer !== 'undefined') {
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        'event': 'search_engine_switch',
        'event_category': 'Search',
        'event_label': engine
      });
    }
  }

  // Function to update mobile search based on current toggle state
  function updateMobileSearch() {
    const toggle = document.getElementById('search-toggle');
    if (!toggle) return;

    const mobileSearchContainer = document.querySelector('.sidebar-header-items__end .navbar-item .search-container-wrapper');
    if (!mobileSearchContainer) return;

    const mobileSphinxSearch = mobileSearchContainer.querySelector('#sphinx-search');
    const mobileGoogleSearch = mobileSearchContainer.querySelector('#google-search');

    if (mobileSphinxSearch && mobileGoogleSearch) {
      mobileSphinxSearch.style.display = toggle.checked ? 'none' : 'block';
      mobileGoogleSearch.style.display = toggle.checked ? 'block' : 'none';

      if (toggle.checked) {
        reinitializeGoogleSearch();
      }
    }
  }

  // Initialize desktop search toggle
  const toggle = document.getElementById('search-toggle');
  const sphinxSearch = document.getElementById('sphinx-search');
  const googleSearch = document.getElementById('google-search');
  handleSearchToggle(toggle, sphinxSearch, googleSearch);

  // Set placeholder text for Google search input
  const observer = new MutationObserver(function() {
    document.querySelectorAll('.gsc-input input').forEach(input => {
      if (input && !input.hasAttribute('data-placeholder-set')) {
        input.setAttribute('placeholder', 'Search the docs ...');
        input.setAttribute('data-placeholder-set', 'true');
      }
    });
  });

  observer.observe(document.body, { childList: true, subtree: true });

  // Fix for scroll jump issue - improved approach
  function setupSearchInputHandlers(input) {
    if (input.hasAttribute('data-scroll-fixed')) return;
    input.setAttribute('data-scroll-fixed', 'true');

    let lastScrollPosition = 0;
    let isTyping = false;
    let scrollTimeout;

    // Save position before typing starts
    input.addEventListener('keydown', () => {
      lastScrollPosition = window.scrollY;
      isTyping = true;

      // Reset typing state after a short delay
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        isTyping = false;
      }, 100);
    });

    // Only maintain scroll position during typing
    function maintainScroll() {
      if (document.activeElement === input && isTyping) {
        window.scrollTo(0, lastScrollPosition);
        requestAnimationFrame(maintainScroll);
      }
    }

    input.addEventListener('focus', () => {
      // Just store initial position but don't force it
      lastScrollPosition = window.scrollY;
    });

    input.addEventListener('input', () => {
      isTyping = true;
      window.scrollTo(0, lastScrollPosition);

      // Reset typing state after a short delay
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        isTyping = false;
      }, 100);

      requestAnimationFrame(maintainScroll);
    });
  }

  // Apply to all search inputs and observe for new ones
  function applyToSearchInputs() {
    document.querySelectorAll('.search-container input, .gsc-input input').forEach(setupSearchInputHandlers);
  }

  applyToSearchInputs();

  const searchObserver = new MutationObserver(applyToSearchInputs);
  searchObserver.observe(document.body, { childList: true, subtree: true });

  // Watch for mobile menu creation
  const mobileMenuObserver = new MutationObserver(function(mutations) {
    for (const mutation of mutations) {
      if (!mutation.addedNodes.length) continue;

      // Style mobile search inputs
      document.querySelectorAll('.sidebar-header-items__end .navbar-item .search-container-wrapper .gsc-input input').forEach(input => {
        if (input) {
          input.setAttribute('placeholder', 'Search the docs ...');
          input.style.paddingLeft = '36px';
        }
      });

      // Check for mobile search container
      const mobileSearchContainer = document.querySelector('.sidebar-header-items__end .navbar-item .search-container-wrapper');
      if (!mobileSearchContainer) continue;

      const mobileToggle = mobileSearchContainer.querySelector('#search-toggle');
      if (mobileToggle && toggle) {
        // Sync mobile toggle with desktop toggle
        mobileToggle.checked = toggle.checked;
        updateMobileSearch();

        // Add event listener to mobile toggle if not already added
        if (!mobileToggle.hasAttribute('data-initialized')) {
          mobileToggle.setAttribute('data-initialized', 'true');
          mobileToggle.addEventListener('change', function() {
            // Sync desktop toggle with mobile toggle
            toggle.checked = this.checked;
            // Trigger change event on desktop toggle to update both
            toggle.dispatchEvent(new Event('change'));
          });
        }
      }
    }
  });

  mobileMenuObserver.observe(document.body, { childList: true, subtree: true });

  // Ensure Google CSE is properly loaded
  if (window.__gcse) {
    window.__gcse.callback = function() {
      // This will run after Google CSE is fully loaded
      if (toggle && toggle.checked) {
        reinitializeGoogleSearch();
      }
    };
  } else {
    window.__gcse = {
      callback: function() {
        if (toggle && toggle.checked) {
          reinitializeGoogleSearch();
        }
      }
    };
  }
});
</script>
</div>
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PyTorchKorea/tutorials-kr" title="한국어 튜토리얼 GitHub 저장소" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">한국어 튜토리얼 GitHub 저장소</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discuss.pytorch.kr/" title="파이토치 한국어 커뮤니티" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">파이토치 한국어 커뮤니티</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">PyTorch를...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">
<div class="rating">
    Rate this Page
    <div class="stars">
        
        <span class="star" data-behavior="tutorial-rating" data-count="1" data-value="1">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="2" data-value="2">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="3" data-value="3">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="4" data-value="4">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="5" data-value="5">★</span>
        
    </div>
</div>
</div>
      
    </div>
  
</div>
</div>
              
              
  
<div id="searchbox"></div>
  <article class="bd-article" id="pytorch-article">
    <!-- Hidden breadcrumb schema for SEO only -->
    <div style="display:none;" itemscope itemtype="https://schema.org/BreadcrumbList">
      
      <div itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <meta itemprop="name" content="PyTorch를 이용한 뉴럴 변환(Neural Transfer)">
        <meta itemprop="position" content="1">
      </div>
    </div>

    
    <script>
      if ((window.location.href.indexOf("/unstable/") != -1) && (window.location.href.indexOf("/unstable/unstable_index") < 1)) {
        var div = '<div class="prototype-banner"><i class="fa fa-flask" aria-hidden="true"></i> <strong>Unstable feature:</strong> Not typically available in binary distributions like PyPI. Early stage for feedback and testing.</div>'
        document.addEventListener('DOMContentLoaded', function () {
          document.getElementById("pytorch-article").insertAdjacentHTML('afterBegin', div);
        });
      }
    </script>
    
    
    <div class="pytorch-call-to-action-links">
      <div id="tutorial-type">advanced/neural_style_tutorial</div>
      <a id="colab-link" data-behavior="call-to-action-event" data-response="Run in Google Colab" target="_blank">
        <div id="google-colab-link">
          <img class="call-to-action-img" src="../_static/img/pytorch-colab.svg" />
          <div class="call-to-action-desktop-view">Run in Google Colab</div>
          <div class="call-to-action-mobile-view">Colab</div>
        </div>
      </a>
      <a id="notebook-link" data-behavior="call-to-action-event" data-response="Download Notebook">
        <div id="download-notebook-link">
          <img class="call-to-action-notebook-img" src="../_static/img/pytorch-download.svg" />
          <div class="call-to-action-desktop-view">Download Notebook</div>
          <div class="call-to-action-mobile-view">Notebook</div>
        </div>
      </a>
      <a id="github-link" data-behavior="call-to-action-event" data-response="View on Github" target="_blank">
        <div id="github-view-link">
          <img class="call-to-action-img" src="../_static/img/pytorch-github.svg" />
          <div class="call-to-action-desktop-view">View on GitHub</div>
          <div class="call-to-action-mobile-view">GitHub</div>
        </div>
      </a>
    </div>
    

    
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">참고</p>
<p><a class="reference internal" href="#sphx-glr-download-advanced-neural-style-tutorial-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="pytorch-neural-transfer">
<span id="sphx-glr-advanced-neural-style-tutorial-py"></span><h1>PyTorch를 이용한 뉴럴 변환(Neural Transfer)<a class="headerlink" href="#pytorch-neural-transfer" title="Link to this heading">#</a></h1>
<p><strong>Author</strong>: <a class="reference external" href="https://alexis-jacq.github.io">Alexis Jacq</a></p>
<p><strong>Edited by</strong>: <a class="reference external" href="https://github.com/winston6">Winston Herring</a></p>
<p><strong>번역</strong>: <a class="reference external" href="https://github.com/jjeamin">정재민</a></p>
<section id="id2">
<h2>소개<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>이번 튜토리얼은 Leon A. Gatys, Alexander S. Ecker and Matthias Bethge에 의해 개발된
<a class="reference external" href="https://arxiv.org/abs/1508.06576">뉴럴 스타일(Neural-Style) 알고리즘</a> 을 구현하는 방법에 대하여 설명합니다.
뉴럴 스타일(Neural-Style), 또는 뉴럴 변환(Neural-Transfer)을 사용하면 이미지를 새로운 예술적 스타일로 재현할 수 있습니다.
이 알고리즘은 입력 이미지, Content 이미지, Style 이미지 3개의 이미지를 가져와서 Content 이미지의 Content와 Style 이미지의 예술적 Style을 닮도록 입력을 변환합니다.</p>
<figure class="align-default">
<img alt="content1" src="../_images/neuralstyle.png" />
</figure>
</section>
<section id="id3">
<h2>기본 원리<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>원리는 간단합니다.
Content(<span class="math">\(D_C\)</span>)와 Style(<span class="math">\(D_S\)</span>)에 대해 하나씩 두 개의 거리를 정의합니다.
<span class="math">\(D_C\)</span> 는 두 이미지 간의 Content의 차이를 측정하고 <span class="math">\(D_S\)</span> 는 두 이미지 간의 Style의 차이를 측정합니다.
그런 다음, 입력으로 사용되는 세 번째 이미지를 가져와서
Content 이미지로 Content 거리와 Style 이미지로 Style 거리를 최소화하도록 변환합니다.
이제 필요한 패키지를 가져와서 뉴럴 변환(neural transfer)을 시작할 수 있습니다.</p>
</section>
<section id="id4">
<h2>패키지 불러오기 및 장치 선택<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<p>다음은 뉴럴 변환(neural transfer)을 구현하는데 필요한 패키지 목록입니다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">torch</span></code>, <code class="docutils literal notranslate"><span class="pre">torch.nn</span></code>, <code class="docutils literal notranslate"><span class="pre">numpy</span></code> (PyTorch로 신경망을 구현하기 위한 필수 패키지)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torch.optim</span></code> (효율적인 경사 하강법)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PIL</span></code>, <code class="docutils literal notranslate"><span class="pre">PIL.Image</span></code>, <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code> (이미지 불러오기 및 이미지 표시)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torchvision.transforms</span></code> (PIL 이미지를 텐서로 변환)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torchvision.models</span></code> (미리 학습된 모델 불러오기 및 학습)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">copy</span></code> (모델을 복사; 시스템 패키지)</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn.functional</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">F</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.optim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">optim</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">torchvision.transforms</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">transforms</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">vgg19</span><span class="p">,</span> <span class="n">VGG19_Weights</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
</pre></div>
</div>
<p>다음으로, 네트워크를 실행 할 장치를 선택하고 Style 이미지와 Content 이미지를 가져와야 합니다.
큰 이미지로 뉴럴 변환(neural transfer) 알고리즘을 실행하면 시간이 오래 걸리고
GPU에서 실행할 때 훨씬 빨라집니다.
<code class="docutils literal notranslate"><span class="pre">torch.cuda.is_available()</span></code> 를 사용하여 GPU를 이용할 수 있는지 알 수 있습니다.
다음으로, 튜토리얼 전체에서 사용 할 <code class="docutils literal notranslate"><span class="pre">torch.device</span></code> 를 설정합니다.
또한 <code class="docutils literal notranslate"><span class="pre">.to(device)</span></code> 메소드는 텐서 또는 모듈을 원하는 장치로 이동하는데 사용됩니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">set_default_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id5">
<h2>이미지 불러오기<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<p>지금 Style, Content 이미지를 가져올 것입니다. 원본 PIL 이미지는 0과 255 사이의 값을 갖지만,
텐서로 변환될 때 0에서 1사이로 변환됩니다.
이미지도 동일한 차원을 가지도록 크기가 변환되어야 합니다.
주목해야 할 중요한 세부 사항은 torch 라이브러리의 신경망은 0에서 1사이의 텐서 값으로 훈련된다는 것입니다.
만약 0에서 255값을 가지는 텐서 이미지가 네트워크에 입력되는 경우,
활성화된 특징 맵이 Content와 Style을 감지할 수 없습니다.
그러나, Caffe 라이브러리의 미리 학습된 네트워크는 0에서 255값을 가지는 입력으로 훈련됩니다.</p>
<div class="admonition note">
<p class="admonition-title">참고</p>
<p>튜토리얼을 실행하는데 필요한 이미지를 다운로드 할 수 있는 주소는 다음과 같습니다.
<a class="reference external" href="https://tutorials.pytorch.kr/_static/img/neural-style/picasso.jpg">picasso.jpg</a> 와
<a class="reference external" href="https://tutorials.pytorch.kr/_static/img/neural-style/dancing.jpg">dancing.jpg</a>.
두 이미지를 다운로드하고 현재 작업 폴더의 <code class="docutils literal notranslate"><span class="pre">images</span></code> 폴더에 추가하세요.</p>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 원하는 출력 이미지의 크기</span>
<span class="n">imsize</span> <span class="o">=</span> <span class="mi">512</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="mi">128</span>  <span class="c1"># 만약 GPU가 없을 경우 작은 크기를 사용</span>

<span class="n">loader</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">(</span><span class="n">imsize</span><span class="p">),</span>  <span class="c1"># 가져온 이미지 크기 조정</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()])</span>  <span class="c1"># 텐서로 변환</span>


<span class="k">def</span><span class="w"> </span><span class="nf">image_loader</span><span class="p">(</span><span class="n">image_name</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span>
    <span class="c1"># 네트워크의 입력 차원에 맞추기 위해 필요한 가짜 배치 차원</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">loader</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>


<span class="n">style_img</span> <span class="o">=</span> <span class="n">image_loader</span><span class="p">(</span><span class="s2">&quot;./data/images/neural-style/picasso.jpg&quot;</span><span class="p">)</span>
<span class="n">content_img</span> <span class="o">=</span> <span class="n">image_loader</span><span class="p">(</span><span class="s2">&quot;./data/images/neural-style/dancing.jpg&quot;</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">style_img</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">content_img</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> \
    <span class="s2">&quot;we need to import style and content images of the same size&quot;</span>
</pre></div>
</div>
<p>이제 이미지를 PIL 형식으로 다시 변환하고 <code class="docutils literal notranslate"><span class="pre">plt.imshow</span></code> 를
사용해 이미지를 표시하는 함수를 만들겠습니다.
Content와 Style 이미지를 표시하여 올바르게 가져왔는지 확인합니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">unloader</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToPILImage</span><span class="p">()</span>  <span class="c1"># PIL 이미지로 다시 변환</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">imshow</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>  <span class="c1"># 텐서를 복제하여 변경하지 않음</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>      <span class="c1"># 가짜 배치 차원 제거</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">unloader</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span> <span class="c1"># plots가 업데이트 되도록 잠시 멈춤</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">style_img</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Style Image&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">content_img</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Content Image&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../_images/sphx_glr_neural_style_tutorial_001.png" srcset="../_images/sphx_glr_neural_style_tutorial_001.png" alt="Style Image" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_neural_style_tutorial_002.png" srcset="../_images/sphx_glr_neural_style_tutorial_002.png" alt="Content Image" class = "sphx-glr-multi-img"/></li>
</ul>
</section>
<section id="id6">
<h2>손실 함수<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<section id="content-loss">
<h3>콘텐츠 손실(Content Loss)<a class="headerlink" href="#content-loss" title="Link to this heading">#</a></h3>
<p>Content 손실은 각 계층에 대한 Content 거리의 가중치 버전을 나타냅니다.
이 함수는 입력 <span class="math">\(X\)</span> 를 처리하는 레이어 <span class="math">\(L\)</span> 의 특징 맵 <span class="math">\(F_{XL}\)</span> 을 가져와서
이미지 <span class="math">\(X\)</span> 와 Content 이미지 <span class="math">\(C\)</span> 사이의
가중 콘텐츠 거리(weighted content distance) <span class="math">\(w_{CL}.D_C^L(X,C)\)</span> 를 반환합니다.
Content 거리를 계산하기 위해 Content 이미지(<span class="math">\(F_{CL}\)</span>)의 특징 맵을 함수에서 알고 있어야합니다.
<span class="math">\(F_{CL}\)</span> 을 입력으로 사용하는 생성자를 사용해 이 함수를 torch 모듈로 구현합니다.
거리 <span class="math">\(\|F_{XL} - F_{CL}\|^2\)</span> 는 두 개의 특징 맵 집합의 평균 제곱 오차이며 <code class="docutils literal notranslate"><span class="pre">nn.MSELoss</span></code> 를 사용하여 계산할 수 있습니다.</p>
<p>Content 거리를 계산하기 위해 사용되는 합성곱 계층 바로 뒤에 Content 손실 모듈을 추가합니다.
이렇게 하면 입력 이미지가 입력될 때마다 Content 손실이 원하는 레이어에서
계산되고 autograd 을 통해 모든 기울기가 계산됩니다.
이제 Content 손실 계층을 만들기 위해 Content 손실을 계산한 다음 계층의 입력을 반환하는
<code class="docutils literal notranslate"><span class="pre">forward</span></code> 메소드를 정의해야합니다.
계산된 손실은 모듈의 매개 변수로써 저장됩니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ContentLoss</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ContentLoss</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># 기울기를 동적으로 계산하는데 사용되는 tree로부터 타깃 Content를 `분리(detach)` 합니다.</span>
        <span class="c1"># 이것은 변수가 아니라 명시된 값입니다.</span>
        <span class="c1"># 그렇지 않으면 criterion의 forward 메소드에서 오류가 발생합니다.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">input</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">참고</p>
<p><strong>중요 세부 사항</strong>: 모듈의 이름은 <code class="docutils literal notranslate"><span class="pre">ContentLoss</span></code> 지만, 실제 PyTorch의 손실 함수는 아닙니다.
만약 Content 손실을 PyTorch의 손실 함수로 정의하려면 Pytorch의 autograd 함수를 생성하여
<code class="docutils literal notranslate"><span class="pre">backward</span></code> 메소드에서 수동으로 기울기를 다시 계산 및 구현 해야 합니다.</p>
</div>
</section>
<section id="style-loss">
<h3>스타일 손실(Style Loss)<a class="headerlink" href="#style-loss" title="Link to this heading">#</a></h3>
<p>Style 손실 모듈은 Content 손실 모듈과 유사하게 구현됩니다.
네트워크에서 해당 계층의 Style 손실을 계산하는 역할을 합니다.
Style 손실을 계산하기 위해서, gram 행렬 <span class="math">\(G_{XL}\)</span> 를 계산해야합니다.
gram 행렬은 주어진 행렬에 전치 행렬을 곱한 결과입니다.
이 어플리케이션에서 주어진 행렬은 계층 <span class="math">\(L\)</span> 의 특징 맵 <span class="math">\(F_{XL}\)</span> 의 재구성된 버전입니다.
<span class="math">\(F_{XL}\)</span> 는 <span class="math">\(K\)</span>x<span class="math">\(N\)</span> 행렬인 <span class="math">\(\hat{F}_{XL}\)</span> 을 형성하도록 재구성되며,
<span class="math">\(K\)</span> 는 계층 <span class="math">\(L\)</span> 의 특징 맵의 수이고 <span class="math">\(N`는 벡터화된 특징 맵의 길이입니다.
예를 들어, :math:\)</span>hat{F}_{XL}` 의 첫 번째 줄은 벡터화된 특징 맵 <span class="math">\(F_{XL}^1\)</span> 에 해당합니다.</p>
<p>마지막으로, gram 행렬은 행렬에서 각 값을 값의 총 개수로 나누어 정규화 해야 합니다.
정규화는 큰 <span class="math">\(N\)</span> 차원을 가지는 <span class="math">\(\hat{F}_{XL}\)</span> 행렬이 gram 행렬에서 더 큰 값을 생성한다는 사실에 대응하기 위한 것입니다.</p>
<p>이와 같은 더 큰 값은 첫 번째 계층(풀링 계층 전)이 경사 하강 중에 더 큰 영향을 미치게합니다.</p>
<p>Style 특징은 네트워크의 깊은 계층에 있는 경향이 있기에 정규화 단계가 중요합니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">gram_matrix</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>  <span class="c1"># a=배치 크기(=1)</span>
    <span class="c1"># b=특징 맵의 수</span>
    <span class="c1"># (c,d)=특징 맵의 차원 (N=c*d)</span>

    <span class="n">features</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>  <span class="c1"># F_XL을 \hat F_XL로 크기 조정</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">t</span><span class="p">())</span>  <span class="c1"># gram product를 계산</span>

    <span class="c1"># 각 특징 맵이 갖는 값의 수로 나누어</span>
    <span class="c1"># gram 행렬의 값을 &#39;정규화&#39;</span>
    <span class="k">return</span> <span class="n">G</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
<p>이제 Style 손실 모듈은 Content 손실 모듈과 거의 똑같아 보입니다.
Style 거리는 <span class="math">\(G_{XL}\)</span> 와 <span class="math">\(G_{SL}\)</span> 사이의 평균 제곱 오차를 사용해 계산됩니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">StyleLoss</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_feature</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StyleLoss</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">gram_matrix</span><span class="p">(</span><span class="n">target_feature</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">gram_matrix</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">input</span>
</pre></div>
</div>
</section>
</section>
<section id="id7">
<h2>모델 가져오기<a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<p>이제는 사전 훈련된 신경망을 가져와야 합니다.
논문에서 사용된 것과 같이 19 계층을 가진 VGG 네트워크를 사용할 것입니다.</p>
<p>PyTorch의 VGG 구현은 <code class="docutils literal notranslate"><span class="pre">features</span></code> (합성곱 및 풀링 계층 포함) 와
<code class="docutils literal notranslate"><span class="pre">classifier</span></code> (완전 연결 계층 포함) 두 가지 하위 <code class="docutils literal notranslate"><span class="pre">Sequential</span></code> 모듈로 구분 된 모듈입니다.
Content 및 Style 손실을 측정하기 위해서 각 합성곱 계층의 출력이 필요하기 때문에 <code class="docutils literal notranslate"><span class="pre">features</span></code> 모듈을 사용할 것입니다.
일부 계층은 훈련하는 중 평가와 다른 동작을 하므로, 네트워크를 <code class="docutils literal notranslate"><span class="pre">.eval()</span></code> 를 사용해 평가 모드로 설정해야합니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">cnn</span> <span class="o">=</span> <span class="n">vgg19</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">VGG19_Weights</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">)</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Downloading: &quot;https://download.pytorch.org/models/vgg19-dcbb9e9d.pth&quot; to /root/.cache/torch/hub/checkpoints/vgg19-dcbb9e9d.pth

  0%|          | 0.00/548M [00:00&lt;?, ?B/s]
  2%|▏         | 8.50M/548M [00:00&lt;00:06, 88.9MB/s]
  4%|▎         | 20.1M/548M [00:00&lt;00:05, 108MB/s]
  6%|▌         | 31.6M/548M [00:00&lt;00:04, 110MB/s]
  8%|▊         | 42.9M/548M [00:00&lt;00:04, 113MB/s]
 10%|▉         | 54.2M/548M [00:00&lt;00:04, 115MB/s]
 12%|█▏        | 65.4M/548M [00:00&lt;00:04, 115MB/s]
 14%|█▍        | 76.6M/548M [00:00&lt;00:04, 116MB/s]
 16%|█▌        | 88.0M/548M [00:00&lt;00:04, 117MB/s]
 18%|█▊        | 99.5M/548M [00:00&lt;00:04, 116MB/s]
 20%|██        | 112M/548M [00:01&lt;00:03, 120MB/s]
 23%|██▎       | 123M/548M [00:01&lt;00:03, 119MB/s]
 25%|██▍       | 135M/548M [00:01&lt;00:03, 117MB/s]
 27%|██▋       | 146M/548M [00:01&lt;00:03, 119MB/s]
 29%|██▉       | 158M/548M [00:01&lt;00:03, 118MB/s]
 31%|███       | 169M/548M [00:01&lt;00:03, 118MB/s]
 33%|███▎      | 180M/548M [00:01&lt;00:03, 116MB/s]
 35%|███▍      | 192M/548M [00:01&lt;00:03, 117MB/s]
 37%|███▋      | 203M/548M [00:01&lt;00:03, 117MB/s]
 39%|███▉      | 214M/548M [00:01&lt;00:02, 117MB/s]
 41%|████      | 226M/548M [00:02&lt;00:02, 117MB/s]
 43%|████▎     | 237M/548M [00:02&lt;00:02, 117MB/s]
 45%|████▌     | 248M/548M [00:02&lt;00:02, 117MB/s]
 47%|████▋     | 259M/548M [00:02&lt;00:02, 117MB/s]
 49%|████▉     | 270M/548M [00:02&lt;00:02, 117MB/s]
 51%|█████▏    | 282M/548M [00:02&lt;00:02, 117MB/s]
 53%|█████▎    | 293M/548M [00:02&lt;00:02, 117MB/s]
 56%|█████▌    | 304M/548M [00:02&lt;00:02, 117MB/s]
 58%|█████▊    | 316M/548M [00:02&lt;00:02, 117MB/s]
 60%|█████▉    | 327M/548M [00:02&lt;00:01, 117MB/s]
 62%|██████▏   | 338M/548M [00:03&lt;00:01, 117MB/s]
 64%|██████▎   | 349M/548M [00:03&lt;00:01, 116MB/s]
 66%|██████▌   | 361M/548M [00:03&lt;00:01, 118MB/s]
 68%|██████▊   | 372M/548M [00:03&lt;00:01, 117MB/s]
 70%|██████▉   | 383M/548M [00:03&lt;00:01, 114MB/s]
 72%|███████▏  | 396M/548M [00:03&lt;00:01, 118MB/s]
 74%|███████▍  | 407M/548M [00:03&lt;00:01, 117MB/s]
 76%|███████▋  | 418M/548M [00:03&lt;00:01, 118MB/s]
 78%|███████▊  | 430M/548M [00:03&lt;00:01, 118MB/s]
 80%|████████  | 441M/548M [00:03&lt;00:00, 117MB/s]
 82%|████████▏ | 452M/548M [00:04&lt;00:00, 115MB/s]
 85%|████████▍ | 464M/548M [00:04&lt;00:00, 118MB/s]
 87%|████████▋ | 476M/548M [00:04&lt;00:00, 116MB/s]
 89%|████████▉ | 487M/548M [00:04&lt;00:00, 115MB/s]
 91%|█████████ | 498M/548M [00:04&lt;00:00, 115MB/s]
 93%|█████████▎| 510M/548M [00:04&lt;00:00, 119MB/s]
 95%|█████████▌| 522M/548M [00:04&lt;00:00, 115MB/s]
 97%|█████████▋| 534M/548M [00:04&lt;00:00, 119MB/s]
 99%|█████████▉| 545M/548M [00:04&lt;00:00, 116MB/s]
100%|██████████| 548M/548M [00:04&lt;00:00, 117MB/s]
</pre></div>
</div>
<p>추가적으로, VGG 네트워크는
mean=[0.485, 0.456, 0.406] 와 std=[0.229, 0.224, 0.225]로 각 채널이 정규화 된
이미지로 훈련됩니다.
이미지를 네트워크로 입력하기 전에 정규화하는데 사용합니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">cnn_normalization_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">])</span>
<span class="n">cnn_normalization_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">])</span>

<span class="c1"># 입력 이미지를 정규화하는 모듈을 생성하여 쉽게 ``nn.Sequential`` 에 넣을 수 있습니다.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Normalization</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Normalization</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># .view 는 mean과 std을 확인해 [B x C x H x W] 형태의</span>
        <span class="c1"># 이미지 텐서를 직접적으로 작업할 수 있도록 [C x 1 x 1] 형태로 만듭니다.</span>
        <span class="c1"># B는 배치 크기입니다. C는 채널의 수입니다. H는 높이고 W는 너비입니다.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">std</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="c1"># ``img`` 정규화</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">img</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Sequential</span></code> 모듈은 순서가 있는 하위 모듈의 리스트가 포함됩니다.
예를 들어, <code class="docutils literal notranslate"><span class="pre">vgg19.features</span></code> 은 올바른 순서로 정렬 된
시퀀스( <code class="docutils literal notranslate"><span class="pre">Conv2d</span></code>, <code class="docutils literal notranslate"><span class="pre">ReLU</span></code>, <code class="docutils literal notranslate"><span class="pre">MaxPool2d</span></code>, <code class="docutils literal notranslate"><span class="pre">Conv2d</span></code>, <code class="docutils literal notranslate"><span class="pre">ReLU</span></code>…)가 포함되어 있습니다.
Content 손실과 Style 손실 계층을 감지하는 합성곱 계층 바로 뒤에 추가해야합니다.
이렇게 하기 위해서는 Content 손실과 Style 손실 모듈이
올바르게 삽입된 새로운 <code class="docutils literal notranslate"><span class="pre">Sequential</span></code> 모듈을 만들어야 합니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Style / Content 손실 계산을 원하는 계층</span>
<span class="n">content_layers_default</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;conv_4&#39;</span><span class="p">]</span>
<span class="n">style_layers_default</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;conv_1&#39;</span><span class="p">,</span> <span class="s1">&#39;conv_2&#39;</span><span class="p">,</span> <span class="s1">&#39;conv_3&#39;</span><span class="p">,</span> <span class="s1">&#39;conv_4&#39;</span><span class="p">,</span> <span class="s1">&#39;conv_5&#39;</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_style_model_and_losses</span><span class="p">(</span><span class="n">cnn</span><span class="p">,</span> <span class="n">normalization_mean</span><span class="p">,</span> <span class="n">normalization_std</span><span class="p">,</span>
                               <span class="n">style_img</span><span class="p">,</span> <span class="n">content_img</span><span class="p">,</span>
                               <span class="n">content_layers</span><span class="o">=</span><span class="n">content_layers_default</span><span class="p">,</span>
                               <span class="n">style_layers</span><span class="o">=</span><span class="n">style_layers_default</span><span class="p">):</span>
    <span class="c1"># 모듈 정규화</span>
    <span class="n">normalization</span> <span class="o">=</span> <span class="n">Normalization</span><span class="p">(</span><span class="n">normalization_mean</span><span class="p">,</span> <span class="n">normalization_std</span><span class="p">)</span>

    <span class="c1"># Content / Style 손실이 반복적으로 접근할 수 있도록 하기 위해</span>
    <span class="n">content_losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">style_losses</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># ``cnn`` 이 ``nn.Sequential`` 이라고 가정하고,</span>
    <span class="c1"># 순차적으로 활성화되어야 하는 모듈에 새로운 ``nn.Sequential`` 을 만듭니다.</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">normalization</span><span class="p">)</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># conv를 볼 때마다 증가</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">cnn</span><span class="o">.</span><span class="n">children</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;conv_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;relu_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="c1"># 아래에 추가한 ``ContentLoss`` 와 ``StyleLoss`` 는 in-place 버전에서는 잘 동작하지 않습니다.</span>
            <span class="c1"># 그래서 여기서는 out-of-place로 대체합니다.</span>
            <span class="n">layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;pool_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;bn_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unrecognized layer: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

        <span class="n">model</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">layer</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">content_layers</span><span class="p">:</span>
            <span class="c1"># Content 손실 추가</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">content_img</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
            <span class="n">content_loss</span> <span class="o">=</span> <span class="n">ContentLoss</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;content_loss_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">content_loss</span><span class="p">)</span>
            <span class="n">content_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content_loss</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">style_layers</span><span class="p">:</span>
            <span class="c1"># Style 손실 추가</span>
            <span class="n">target_feature</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">style_img</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
            <span class="n">style_loss</span> <span class="o">=</span> <span class="n">StyleLoss</span><span class="p">(</span><span class="n">target_feature</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;style_loss_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">style_loss</span><span class="p">)</span>
            <span class="n">style_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">style_loss</span><span class="p">)</span>

    <span class="c1"># 이제 마지막 Content 및 Style 손실 뒤에 계층을 잘라냅니다.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ContentLoss</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">StyleLoss</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">[:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">style_losses</span><span class="p">,</span> <span class="n">content_losses</span>
</pre></div>
</div>
<p>다음으로 입력 이미지를 선택합니다. Content 이미지 사본이나 백색 잡음을 사용할 수 있습니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">input_img</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">content_img</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 만약 화이트 노이즈(white noise)을 사용하려면 아래 주석을 제거하세요:</span>
<span class="c1">#</span>
<span class="c1"># ::</span>
<span class="c1">#</span>
<span class="c1">#    input_img = torch.randn(content_img.data.size(), device=device)</span>

<span class="c1"># 그림에 원본 입력 이미지를 추가합니다.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">input_img</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Input Image&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-pytb notranslate"><div class="highlight"><pre><span></span><span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/workspace/tutorials-kr/advanced_source/neural_style_tutorial.py&quot;</span>, line <span class="m">359</span>, in <span class="n">&lt;module&gt;</span>
<span class="w">    </span><span class="n">imshow</span><span class="p">(</span><span class="n">input_img</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Input Image&#39;</span><span class="p">)</span>
<span class="w">           </span><span class="pm">^^^^^^^^^</span>
<span class="gr">NameError</span>: <span class="n">name &#39;input_img&#39; is not defined</span>
</pre></div>
</div>
</section>
<section id="id8">
<h2>경사 하강법<a class="headerlink" href="#id8" title="Link to this heading">#</a></h2>
<p>알고리즘 작성자인 Leon Gatys가
<a class="reference external" href="https://discuss.pytorch.org/t/pytorch-tutorial-for-neural-transfert-of-artistic-style/336/20?u=alexis-jacq">여기</a> 에서 제안했던 것처럼,
L-BFGS 알고리즘을 사용하여 경사 하강법을 수행합니다.
네트워크 훈련과 다르게 Content / Style 손실을 최소화하기 위해 입력 이미지를 훈련하려고 합니다.
파이토치 L-BFGS optimizer <code class="docutils literal notranslate"><span class="pre">optim.LBFGS</span></code> 를 만들고 최적화 할 텐서로 이미지를 전달합니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_input_optimizer</span><span class="p">(</span><span class="n">input_img</span><span class="p">):</span>
    <span class="c1"># 입력이 기울기가 필요한 매개 변수임을 표시하는 줄</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">LBFGS</span><span class="p">([</span><span class="n">input_img</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">optimizer</span>
</pre></div>
</div>
<p>마지막으로 뉴럴 변환(neural transfer)을 수행하는 함수를 정의해야 합니다.
네트워크의 각 반복 동안, 업데이트된 입력이 주어지고 새로운 손실을 계산합니다.
각 손실 모듈(Loss module)의 <code class="docutils literal notranslate"><span class="pre">backward</span></code> 메소드를 실행하여 기울기를 동적으로 계산합니다.
optimizer는 모듈을 재평가하고 손실을 반환하는 “closure” 함수가 필요합니다.</p>
<p>여전히 해결해야 할 마지막 제약이 있습니다.
네트워크가 이미지에 대해 0 ~ 1 텐서 범위를 초과하는 값으로 최적화하려 할 수 있습니다.
네트워크가 실행될 때마다 입력값을 0에서 1사이로 수정하여 문제를 해결할 수 있습니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">run_style_transfer</span><span class="p">(</span><span class="n">cnn</span><span class="p">,</span> <span class="n">normalization_mean</span><span class="p">,</span> <span class="n">normalization_std</span><span class="p">,</span>
                       <span class="n">content_img</span><span class="p">,</span> <span class="n">style_img</span><span class="p">,</span> <span class="n">input_img</span><span class="p">,</span> <span class="n">num_steps</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                       <span class="n">style_weight</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">content_weight</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the style transfer.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Building the style transfer model..&#39;</span><span class="p">)</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">style_losses</span><span class="p">,</span> <span class="n">content_losses</span> <span class="o">=</span> <span class="n">get_style_model_and_losses</span><span class="p">(</span><span class="n">cnn</span><span class="p">,</span>
        <span class="n">normalization_mean</span><span class="p">,</span> <span class="n">normalization_std</span><span class="p">,</span> <span class="n">style_img</span><span class="p">,</span> <span class="n">content_img</span><span class="p">)</span>

    <span class="c1"># 모델의 매개변수를 제외한 입력을 최적화해야 하므로</span>
    <span class="c1"># 이에 맞춰서 requires_grad 값을 갱신합니다.</span>
    <span class="n">input_img</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># 또한, 모델을 평가(eval) 모드로 전환하여</span>
    <span class="c1"># 드롭아웃(dropout) 및 배치 정규화(batch normalization)와 같은 특정 레이어가 올바르게 동작하도록 합니다.</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">get_input_optimizer</span><span class="p">(</span><span class="n">input_img</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Optimizing..&#39;</span><span class="p">)</span>
    <span class="n">run</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">num_steps</span><span class="p">:</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">closure</span><span class="p">():</span>
            <span class="c1"># 업데이트 된 입력 이미지의 값을 수정</span>
            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="n">input_img</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">model</span><span class="p">(</span><span class="n">input_img</span><span class="p">)</span>
            <span class="n">style_score</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">content_score</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">sl</span> <span class="ow">in</span> <span class="n">style_losses</span><span class="p">:</span>
                <span class="n">style_score</span> <span class="o">+=</span> <span class="n">sl</span><span class="o">.</span><span class="n">loss</span>
            <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">content_losses</span><span class="p">:</span>
                <span class="n">content_score</span> <span class="o">+=</span> <span class="n">cl</span><span class="o">.</span><span class="n">loss</span>

            <span class="n">style_score</span> <span class="o">*=</span> <span class="n">style_weight</span>
            <span class="n">content_score</span> <span class="o">*=</span> <span class="n">content_weight</span>

            <span class="n">loss</span> <span class="o">=</span> <span class="n">style_score</span> <span class="o">+</span> <span class="n">content_score</span>
            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

            <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">50</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;run </span><span class="si">{}</span><span class="s2">:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Style Loss : </span><span class="si">{:4f}</span><span class="s1"> Content Loss: </span><span class="si">{:4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">style_score</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">content_score</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
                <span class="nb">print</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">style_score</span> <span class="o">+</span> <span class="n">content_score</span>

        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">closure</span><span class="p">)</span>

    <span class="c1"># 마지막 수정...</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">input_img</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">input_img</span>
</pre></div>
</div>
<p>마지막으로, 알고리즘을 실행합니다.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">run_style_transfer</span><span class="p">(</span><span class="n">cnn</span><span class="p">,</span> <span class="n">cnn_normalization_mean</span><span class="p">,</span> <span class="n">cnn_normalization_std</span><span class="p">,</span>
                            <span class="n">content_img</span><span class="p">,</span> <span class="n">style_img</span><span class="p">,</span> <span class="n">input_img</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Output Image&#39;</span><span class="p">)</span>

<span class="c1"># sphinx_gallery_thumbnail_number = 4</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 9.832 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-advanced-neural-style-tutorial-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/cad5020cab595c3bf83a518b7e4d4125/neural_style_tutorial.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">neural_style_tutorial.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/b3bcd49c4dd9be3a44c6c5d2e2a8b0cd/neural_style_tutorial.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">neural_style_tutorial.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/3b60901c920861929899054fd11b0ffc/neural_style_tutorial.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">neural_style_tutorial.zip</span></code></a></p>
</div>
</div>
</section>
</section>


                </article>
              
  </article>
  
              
              
                <footer class="bd-footer-article">
                  <div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item">
<div class="feedback">
  
<div class="rating">
    Rate this Page
    <div class="stars">
        
        <span class="star" data-behavior="tutorial-rating" data-count="1" data-value="1">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="2" data-value="2">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="3" data-value="3">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="4" data-value="4">★</span>
        
        <span class="star" data-behavior="tutorial-rating" data-count="5" data-value="5">★</span>
        
    </div>
</div>

  <div class="feedback-send">
    <button class="feedback-btn"
            onclick="openGitHubIssue()"
            data-bs-title="Create a GitHub Issue"
            data-bs-placement="bottom"
            data-bs-toggle="tooltip"
            data-gtm="feedback-btn-click">Send Feedback
    </button>
  </div>
</div>

<div class="prev-next-area">
</div>

<div class="footer-info">
  <p class="copyright">
    
      
        © Copyright 2018-2025, PyTorch &amp; 파이토치 한국 사용자 모임(PyTorchKR).
      
      <br/>
    
  </p>

  <p class="theme-version">
    Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
  </p>
</div>
</div>
  
</div>
                </footer>
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc">
<div class="sidebar-secondary-items sidebar-secondary__inner">
    
       <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">소개</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">기본 원리</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">패키지 불러오기 및 장치 선택</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">이미지 불러오기</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">손실 함수</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#content-loss">콘텐츠 손실(Content Loss)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#style-loss">스타일 손실(Style Loss)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">모델 가져오기</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">경사 하강법</a></li>
</ul>
  </nav></div>
    




<div class="sidebar-secondary-item">
  <div class="sidebar-heading">PyTorch Libraries</div>
  <ul style="list-style-type: none; padding: 0; padding-bottom: 80px;">
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/ao" style="color: var(--pst-color-text-muted)">torchao</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/torchrec" style="color: var(--pst-color-text-muted)">torchrec</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/torchft" style="color: var(--pst-color-text-muted)">torchft</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/torchcodec" style="color: var(--pst-color-text-muted)">TorchCodec</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/vision" style="color: var(--pst-color-text-muted)">torchvision</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/executorch" style="color: var(--pst-color-text-muted)">ExecuTorch</a></li>
  
   <li><a class="nav-link nav-external" href="https://docs.pytorch.org/xla" style="color: var(--pst-color-text-muted)">PyTorch on XLA Devices</a></li>
  
  </ul>
</div>

</div>
</div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <div class="container-fluid docs-tutorials-resources">
  <div class="container">
    <div class="row">
      <div class="col-md-4 text-center">
        <h2>PyTorchKorea @ GitHub</h2>
        <p>파이토치 한국 사용자 모임을 GitHub에서 만나보세요.</p>
        <a class="with-right-arrow" href="https://github.com/PyTorchKorea">GitHub로 이동</a>
      </div>

      <div class="col-md-4 text-center">
        <h2>한국어 튜토리얼</h2>
        <p>한국어로 번역 중인 파이토치 튜토리얼을 만나보세요.</p>
        <a class="with-right-arrow" href="https://tutorials.pytorch.kr/">튜토리얼로 이동</a>
      </div>

      <div class="col-md-4 text-center">
        <h2>한국어 커뮤니티</h2>
        <p>다른 사용자들과 의견을 나누고, 도와주세요!</p>
        <a class="with-right-arrow" href="https://discuss.pytorch.kr/">커뮤니티로 이동</a>
      </div>
    </div>
  </div>
</div>

<footer class="site-footer">
  <div class="container footer-container">
    <div class="footer-logo-wrapper">
      <a href="https://pytorch.kr/" class="footer-logo"></a>
    </div>

    <div class="footer-links-wrapper">
      <div class="footer-links-col">
        <ul>
          <li class="list-title"><a href="https://pytorch.kr/">파이토치 한국 사용자 모임</a></li>
          <li><a href="https://pytorch.kr/about">사용자 모임 소개</a></li>
          <li><a href="https://pytorch.kr/contributors">기여해주신 분들</a></li>
          <li><a href="https://pytorch.kr/resources/">리소스</a></li>
          <li><a href="https://pytorch.kr/coc">행동 강령</a></li>
        </ul>
      </div>
    </div>

    <div class="trademark-disclaimer">
      <ul>
        <li>이 사이트는 독립적인 파이토치 사용자 커뮤니티로, 최신 버전이 아니거나 잘못된 내용이 포함되어 있을 수 있습니다. This site is an independent user community and may be out of date or contain incorrect information.</li>
        <li><a href="https://pytorch.kr/coc">행동 강령</a>을 읽고 지켜주세요. PyTorch 공식 로고 사용 규정은 <a href="https://www.linuxfoundation.org/policies/">Linux Foundation의 정책</a>을 따릅니다. Please read and follow <a href="https://pytorch.kr/coc">our code of conduct</a>. All PyTorch trademark policy applicable to <a href="https://www.linuxfoundation.org/policies/">Linux Foundation's policies</a>.</li>
      </ul>
    </div>
  </div>
</footer>

<div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../_static/img/pytorch-x.svg">
  </div>
</div>
  
  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2018-2025, PyTorch &amp; 파이토치 한국 사용자 모임(PyTorchKR).
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6 버전으로 생성되었습니다.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  <script type="application/ld+json">
    {
       "@context": "https://schema.org",
       "@type": "Article",
       "name": "PyTorch\ub97c \uc774\uc6a9\ud55c \ub274\ub7f4 \ubcc0\ud658(Neural Transfer)",
       "headline": "PyTorch\ub97c \uc774\uc6a9\ud55c \ub274\ub7f4 \ubcc0\ud658(Neural Transfer)",
       "description": "PyTorch Documentation. Explore PyTorch, an open-source machine learning library that accelerates the path from research prototyping to production deployment. Discover tutorials, API references, and guides to help you build and deploy deep learning models efficiently.",
       "url": "/advanced/neural_style_tutorial.html",
       "articleBody": "\ucc38\uace0 Go to the end to download the full example code. PyTorch\ub97c \uc774\uc6a9\ud55c \ub274\ub7f4 \ubcc0\ud658(Neural Transfer)# Author: Alexis Jacq Edited by: Winston Herring \ubc88\uc5ed: \uc815\uc7ac\ubbfc \uc18c\uac1c# \uc774\ubc88 \ud29c\ud1a0\ub9ac\uc5bc\uc740 Leon A. Gatys, Alexander S. Ecker and Matthias Bethge\uc5d0 \uc758\ud574 \uac1c\ubc1c\ub41c \ub274\ub7f4 \uc2a4\ud0c0\uc77c(Neural-Style) \uc54c\uace0\ub9ac\uc998 \uc744 \uad6c\ud604\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud558\uc5ec \uc124\uba85\ud569\ub2c8\ub2e4. \ub274\ub7f4 \uc2a4\ud0c0\uc77c(Neural-Style), \ub610\ub294 \ub274\ub7f4 \ubcc0\ud658(Neural-Transfer)\uc744 \uc0ac\uc6a9\ud558\uba74 \uc774\ubbf8\uc9c0\ub97c \uc0c8\ub85c\uc6b4 \uc608\uc220\uc801 \uc2a4\ud0c0\uc77c\ub85c \uc7ac\ud604\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc54c\uace0\ub9ac\uc998\uc740 \uc785\ub825 \uc774\ubbf8\uc9c0, Content \uc774\ubbf8\uc9c0, Style \uc774\ubbf8\uc9c0 3\uac1c\uc758 \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc640\uc11c Content \uc774\ubbf8\uc9c0\uc758 Content\uc640 Style \uc774\ubbf8\uc9c0\uc758 \uc608\uc220\uc801 Style\uc744 \ub2ee\ub3c4\ub85d \uc785\ub825\uc744 \ubcc0\ud658\ud569\ub2c8\ub2e4. \uae30\ubcf8 \uc6d0\ub9ac# \uc6d0\ub9ac\ub294 \uac04\ub2e8\ud569\ub2c8\ub2e4. Content(\\(D_C\\))\uc640 Style(\\(D_S\\))\uc5d0 \ub300\ud574 \ud558\ub098\uc529 \ub450 \uac1c\uc758 \uac70\ub9ac\ub97c \uc815\uc758\ud569\ub2c8\ub2e4. \\(D_C\\) \ub294 \ub450 \uc774\ubbf8\uc9c0 \uac04\uc758 Content\uc758 \ucc28\uc774\ub97c \uce21\uc815\ud558\uace0 \\(D_S\\) \ub294 \ub450 \uc774\ubbf8\uc9c0 \uac04\uc758 Style\uc758 \ucc28\uc774\ub97c \uce21\uc815\ud569\ub2c8\ub2e4. \uadf8\ub7f0 \ub2e4\uc74c, \uc785\ub825\uc73c\ub85c \uc0ac\uc6a9\ub418\ub294 \uc138 \ubc88\uc9f8 \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc640\uc11c Content \uc774\ubbf8\uc9c0\ub85c Content \uac70\ub9ac\uc640 Style \uc774\ubbf8\uc9c0\ub85c Style \uac70\ub9ac\ub97c \ucd5c\uc18c\ud654\ud558\ub3c4\ub85d \ubcc0\ud658\ud569\ub2c8\ub2e4. \uc774\uc81c \ud544\uc694\ud55c \ud328\ud0a4\uc9c0\ub97c \uac00\uc838\uc640\uc11c \ub274\ub7f4 \ubcc0\ud658(neural transfer)\uc744 \uc2dc\uc791\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud328\ud0a4\uc9c0 \ubd88\ub7ec\uc624\uae30 \ubc0f \uc7a5\uce58 \uc120\ud0dd# \ub2e4\uc74c\uc740 \ub274\ub7f4 \ubcc0\ud658(neural transfer)\uc744 \uad6c\ud604\ud558\ub294\ub370 \ud544\uc694\ud55c \ud328\ud0a4\uc9c0 \ubaa9\ub85d\uc785\ub2c8\ub2e4. torch, torch.nn, numpy (PyTorch\ub85c \uc2e0\uacbd\ub9dd\uc744 \uad6c\ud604\ud558\uae30 \uc704\ud55c \ud544\uc218 \ud328\ud0a4\uc9c0) torch.optim (\ud6a8\uc728\uc801\uc778 \uacbd\uc0ac \ud558\uac15\ubc95) PIL, PIL.Image, matplotlib.pyplot (\uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \ubc0f \uc774\ubbf8\uc9c0 \ud45c\uc2dc) torchvision.transforms (PIL \uc774\ubbf8\uc9c0\ub97c \ud150\uc11c\ub85c \ubcc0\ud658) torchvision.models (\ubbf8\ub9ac \ud559\uc2b5\ub41c \ubaa8\ub378 \ubd88\ub7ec\uc624\uae30 \ubc0f \ud559\uc2b5) copy (\ubaa8\ub378\uc744 \ubcf5\uc0ac; \uc2dc\uc2a4\ud15c \ud328\ud0a4\uc9c0) import torch import torch.nn as nn import torch.nn.functional as F import torch.optim as optim from PIL import Image import matplotlib.pyplot as plt import torchvision.transforms as transforms from torchvision.models import vgg19, VGG19_Weights import copy \ub2e4\uc74c\uc73c\ub85c, \ub124\ud2b8\uc6cc\ud06c\ub97c \uc2e4\ud589 \ud560 \uc7a5\uce58\ub97c \uc120\ud0dd\ud558\uace0 Style \uc774\ubbf8\uc9c0\uc640 Content \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc640\uc57c \ud569\ub2c8\ub2e4. \ud070 \uc774\ubbf8\uc9c0\ub85c \ub274\ub7f4 \ubcc0\ud658(neural transfer) \uc54c\uace0\ub9ac\uc998\uc744 \uc2e4\ud589\ud558\uba74 \uc2dc\uac04\uc774 \uc624\ub798 \uac78\ub9ac\uace0 GPU\uc5d0\uc11c \uc2e4\ud589\ud560 \ub54c \ud6e8\uc52c \ube68\ub77c\uc9d1\ub2c8\ub2e4. torch.cuda.is_available() \ub97c \uc0ac\uc6a9\ud558\uc5ec GPU\ub97c \uc774\uc6a9\ud560 \uc218 \uc788\ub294\uc9c0 \uc54c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c\uc73c\ub85c, \ud29c\ud1a0\ub9ac\uc5bc \uc804\uccb4\uc5d0\uc11c \uc0ac\uc6a9 \ud560 torch.device \ub97c \uc124\uc815\ud569\ub2c8\ub2e4. \ub610\ud55c .to(device) \uba54\uc18c\ub4dc\ub294 \ud150\uc11c \ub610\ub294 \ubaa8\ub4c8\uc744 \uc6d0\ud558\ub294 \uc7a5\uce58\ub85c \uc774\ub3d9\ud558\ub294\ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\") torch.set_default_device(device) \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30# \uc9c0\uae08 Style, Content \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc62c \uac83\uc785\ub2c8\ub2e4. \uc6d0\ubcf8 PIL \uc774\ubbf8\uc9c0\ub294 0\uacfc 255 \uc0ac\uc774\uc758 \uac12\uc744 \uac16\uc9c0\ub9cc, \ud150\uc11c\ub85c \ubcc0\ud658\ub420 \ub54c 0\uc5d0\uc11c 1\uc0ac\uc774\ub85c \ubcc0\ud658\ub429\ub2c8\ub2e4. \uc774\ubbf8\uc9c0\ub3c4 \ub3d9\uc77c\ud55c \ucc28\uc6d0\uc744 \uac00\uc9c0\ub3c4\ub85d \ud06c\uae30\uac00 \ubcc0\ud658\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc8fc\ubaa9\ud574\uc57c \ud560 \uc911\uc694\ud55c \uc138\ubd80 \uc0ac\ud56d\uc740 torch \ub77c\uc774\ube0c\ub7ec\ub9ac\uc758 \uc2e0\uacbd\ub9dd\uc740 0\uc5d0\uc11c 1\uc0ac\uc774\uc758 \ud150\uc11c \uac12\uc73c\ub85c \ud6c8\ub828\ub41c\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4. \ub9cc\uc57d 0\uc5d0\uc11c 255\uac12\uc744 \uac00\uc9c0\ub294 \ud150\uc11c \uc774\ubbf8\uc9c0\uac00 \ub124\ud2b8\uc6cc\ud06c\uc5d0 \uc785\ub825\ub418\ub294 \uacbd\uc6b0, \ud65c\uc131\ud654\ub41c \ud2b9\uc9d5 \ub9f5\uc774 Content\uc640 Style\uc744 \uac10\uc9c0\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uadf8\ub7ec\ub098, Caffe \ub77c\uc774\ube0c\ub7ec\ub9ac\uc758 \ubbf8\ub9ac \ud559\uc2b5\ub41c \ub124\ud2b8\uc6cc\ud06c\ub294 0\uc5d0\uc11c 255\uac12\uc744 \uac00\uc9c0\ub294 \uc785\ub825\uc73c\ub85c \ud6c8\ub828\ub429\ub2c8\ub2e4. \ucc38\uace0 \ud29c\ud1a0\ub9ac\uc5bc\uc744 \uc2e4\ud589\ud558\ub294\ub370 \ud544\uc694\ud55c \uc774\ubbf8\uc9c0\ub97c \ub2e4\uc6b4\ub85c\ub4dc \ud560 \uc218 \uc788\ub294 \uc8fc\uc18c\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4. picasso.jpg \uc640 dancing.jpg. \ub450 \uc774\ubbf8\uc9c0\ub97c \ub2e4\uc6b4\ub85c\ub4dc\ud558\uace0 \ud604\uc7ac \uc791\uc5c5 \ud3f4\ub354\uc758 images \ud3f4\ub354\uc5d0 \ucd94\uac00\ud558\uc138\uc694. # \uc6d0\ud558\ub294 \ucd9c\ub825 \uc774\ubbf8\uc9c0\uc758 \ud06c\uae30 imsize = 512 if torch.cuda.is_available() else 128 # \ub9cc\uc57d GPU\uac00 \uc5c6\uc744 \uacbd\uc6b0 \uc791\uc740 \ud06c\uae30\ub97c \uc0ac\uc6a9 loader = transforms.Compose([ transforms.Resize(imsize), # \uac00\uc838\uc628 \uc774\ubbf8\uc9c0 \ud06c\uae30 \uc870\uc815 transforms.ToTensor()]) # \ud150\uc11c\ub85c \ubcc0\ud658 def image_loader(image_name): image = Image.open(image_name) # \ub124\ud2b8\uc6cc\ud06c\uc758 \uc785\ub825 \ucc28\uc6d0\uc5d0 \ub9de\ucd94\uae30 \uc704\ud574 \ud544\uc694\ud55c \uac00\uc9dc \ubc30\uce58 \ucc28\uc6d0 image = loader(image).unsqueeze(0) return image.to(device, torch.float) style_img = image_loader(\"./data/images/neural-style/picasso.jpg\") content_img = image_loader(\"./data/images/neural-style/dancing.jpg\") assert style_img.size() == content_img.size(), \\ \"we need to import style and content images of the same size\" \uc774\uc81c \uc774\ubbf8\uc9c0\ub97c PIL \ud615\uc2dd\uc73c\ub85c \ub2e4\uc2dc \ubcc0\ud658\ud558\uace0 plt.imshow \ub97c \uc0ac\uc6a9\ud574 \uc774\ubbf8\uc9c0\ub97c \ud45c\uc2dc\ud558\ub294 \ud568\uc218\ub97c \ub9cc\ub4e4\uaca0\uc2b5\ub2c8\ub2e4. Content\uc640 Style \uc774\ubbf8\uc9c0\ub97c \ud45c\uc2dc\ud558\uc5ec \uc62c\ubc14\ub974\uac8c \uac00\uc838\uc654\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. unloader = transforms.ToPILImage() # PIL \uc774\ubbf8\uc9c0\ub85c \ub2e4\uc2dc \ubcc0\ud658 plt.ion() def imshow(tensor, title=None): image = tensor.cpu().clone() # \ud150\uc11c\ub97c \ubcf5\uc81c\ud558\uc5ec \ubcc0\uacbd\ud558\uc9c0 \uc54a\uc74c image = image.squeeze(0) # \uac00\uc9dc \ubc30\uce58 \ucc28\uc6d0 \uc81c\uac70 image = unloader(image) plt.imshow(image) if title is not None: plt.title(title) plt.pause(0.001) # plots\uac00 \uc5c5\ub370\uc774\ud2b8 \ub418\ub3c4\ub85d \uc7a0\uc2dc \uba48\ucda4 plt.figure() imshow(style_img, title=\u0027Style Image\u0027) plt.figure() imshow(content_img, title=\u0027Content Image\u0027) \uc190\uc2e4 \ud568\uc218# \ucf58\ud150\uce20 \uc190\uc2e4(Content Loss)# Content \uc190\uc2e4\uc740 \uac01 \uacc4\uce35\uc5d0 \ub300\ud55c Content \uac70\ub9ac\uc758 \uac00\uc911\uce58 \ubc84\uc804\uc744 \ub098\ud0c0\ub0c5\ub2c8\ub2e4. \uc774 \ud568\uc218\ub294 \uc785\ub825 \\(X\\) \ub97c \ucc98\ub9ac\ud558\ub294 \ub808\uc774\uc5b4 \\(L\\) \uc758 \ud2b9\uc9d5 \ub9f5 \\(F_{XL}\\) \uc744 \uac00\uc838\uc640\uc11c \uc774\ubbf8\uc9c0 \\(X\\) \uc640 Content \uc774\ubbf8\uc9c0 \\(C\\) \uc0ac\uc774\uc758 \uac00\uc911 \ucf58\ud150\uce20 \uac70\ub9ac(weighted content distance) \\(w_{CL}.D_C^L(X,C)\\) \ub97c \ubc18\ud658\ud569\ub2c8\ub2e4. Content \uac70\ub9ac\ub97c \uacc4\uc0b0\ud558\uae30 \uc704\ud574 Content \uc774\ubbf8\uc9c0(\\(F_{CL}\\))\uc758 \ud2b9\uc9d5 \ub9f5\uc744 \ud568\uc218\uc5d0\uc11c \uc54c\uace0 \uc788\uc5b4\uc57c\ud569\ub2c8\ub2e4. \\(F_{CL}\\) \uc744 \uc785\ub825\uc73c\ub85c \uc0ac\uc6a9\ud558\ub294 \uc0dd\uc131\uc790\ub97c \uc0ac\uc6a9\ud574 \uc774 \ud568\uc218\ub97c torch \ubaa8\ub4c8\ub85c \uad6c\ud604\ud569\ub2c8\ub2e4. \uac70\ub9ac \\(\\|F_{XL} - F_{CL}\\|^2\\) \ub294 \ub450 \uac1c\uc758 \ud2b9\uc9d5 \ub9f5 \uc9d1\ud569\uc758 \ud3c9\uade0 \uc81c\uacf1 \uc624\ucc28\uc774\uba70 nn.MSELoss \ub97c \uc0ac\uc6a9\ud558\uc5ec \uacc4\uc0b0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Content \uac70\ub9ac\ub97c \uacc4\uc0b0\ud558\uae30 \uc704\ud574 \uc0ac\uc6a9\ub418\ub294 \ud569\uc131\uacf1 \uacc4\uce35 \ubc14\ub85c \ub4a4\uc5d0 Content \uc190\uc2e4 \ubaa8\ub4c8\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uc785\ub825 \uc774\ubbf8\uc9c0\uac00 \uc785\ub825\ub420 \ub54c\ub9c8\ub2e4 Content \uc190\uc2e4\uc774 \uc6d0\ud558\ub294 \ub808\uc774\uc5b4\uc5d0\uc11c \uacc4\uc0b0\ub418\uace0 autograd \uc744 \ud1b5\ud574 \ubaa8\ub4e0 \uae30\uc6b8\uae30\uac00 \uacc4\uc0b0\ub429\ub2c8\ub2e4. \uc774\uc81c Content \uc190\uc2e4 \uacc4\uce35\uc744 \ub9cc\ub4e4\uae30 \uc704\ud574 Content \uc190\uc2e4\uc744 \uacc4\uc0b0\ud55c \ub2e4\uc74c \uacc4\uce35\uc758 \uc785\ub825\uc744 \ubc18\ud658\ud558\ub294 forward \uba54\uc18c\ub4dc\ub97c \uc815\uc758\ud574\uc57c\ud569\ub2c8\ub2e4. \uacc4\uc0b0\ub41c \uc190\uc2e4\uc740 \ubaa8\ub4c8\uc758 \ub9e4\uac1c \ubcc0\uc218\ub85c\uc368 \uc800\uc7a5\ub429\ub2c8\ub2e4. class ContentLoss(nn.Module): def __init__(self, target,): super(ContentLoss, self).__init__() # \uae30\uc6b8\uae30\ub97c \ub3d9\uc801\uc73c\ub85c \uacc4\uc0b0\ud558\ub294\ub370 \uc0ac\uc6a9\ub418\ub294 tree\ub85c\ubd80\ud130 \ud0c0\uae43 Content\ub97c `\ubd84\ub9ac(detach)` \ud569\ub2c8\ub2e4. # \uc774\uac83\uc740 \ubcc0\uc218\uac00 \uc544\ub2c8\ub77c \uba85\uc2dc\ub41c \uac12\uc785\ub2c8\ub2e4. # \uadf8\ub807\uc9c0 \uc54a\uc73c\uba74 criterion\uc758 forward \uba54\uc18c\ub4dc\uc5d0\uc11c \uc624\ub958\uac00 \ubc1c\uc0dd\ud569\ub2c8\ub2e4. self.target = target.detach() def forward(self, input): self.loss = F.mse_loss(input, self.target) return input \ucc38\uace0 \uc911\uc694 \uc138\ubd80 \uc0ac\ud56d: \ubaa8\ub4c8\uc758 \uc774\ub984\uc740 ContentLoss \uc9c0\ub9cc, \uc2e4\uc81c PyTorch\uc758 \uc190\uc2e4 \ud568\uc218\ub294 \uc544\ub2d9\ub2c8\ub2e4. \ub9cc\uc57d Content \uc190\uc2e4\uc744 PyTorch\uc758 \uc190\uc2e4 \ud568\uc218\ub85c \uc815\uc758\ud558\ub824\uba74 Pytorch\uc758 autograd \ud568\uc218\ub97c \uc0dd\uc131\ud558\uc5ec backward \uba54\uc18c\ub4dc\uc5d0\uc11c \uc218\ub3d9\uc73c\ub85c \uae30\uc6b8\uae30\ub97c \ub2e4\uc2dc \uacc4\uc0b0 \ubc0f \uad6c\ud604 \ud574\uc57c \ud569\ub2c8\ub2e4. \uc2a4\ud0c0\uc77c \uc190\uc2e4(Style Loss)# Style \uc190\uc2e4 \ubaa8\ub4c8\uc740 Content \uc190\uc2e4 \ubaa8\ub4c8\uacfc \uc720\uc0ac\ud558\uac8c \uad6c\ud604\ub429\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c\uc5d0\uc11c \ud574\ub2f9 \uacc4\uce35\uc758 Style \uc190\uc2e4\uc744 \uacc4\uc0b0\ud558\ub294 \uc5ed\ud560\uc744 \ud569\ub2c8\ub2e4. Style \uc190\uc2e4\uc744 \uacc4\uc0b0\ud558\uae30 \uc704\ud574\uc11c, gram \ud589\ub82c \\(G_{XL}\\) \ub97c \uacc4\uc0b0\ud574\uc57c\ud569\ub2c8\ub2e4. gram \ud589\ub82c\uc740 \uc8fc\uc5b4\uc9c4 \ud589\ub82c\uc5d0 \uc804\uce58 \ud589\ub82c\uc744 \uacf1\ud55c \uacb0\uacfc\uc785\ub2c8\ub2e4. \uc774 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c \uc8fc\uc5b4\uc9c4 \ud589\ub82c\uc740 \uacc4\uce35 \\(L\\) \uc758 \ud2b9\uc9d5 \ub9f5 \\(F_{XL}\\) \uc758 \uc7ac\uad6c\uc131\ub41c \ubc84\uc804\uc785\ub2c8\ub2e4. \\(F_{XL}\\) \ub294 \\(K\\)x\\(N\\) \ud589\ub82c\uc778 \\(\\hat{F}_{XL}\\) \uc744 \ud615\uc131\ud558\ub3c4\ub85d \uc7ac\uad6c\uc131\ub418\uba70, \\(K\\) \ub294 \uacc4\uce35 \\(L\\) \uc758 \ud2b9\uc9d5 \ub9f5\uc758 \uc218\uc774\uace0 \\(N`\ub294 \ubca1\ud130\ud654\ub41c \ud2b9\uc9d5 \ub9f5\uc758 \uae38\uc774\uc785\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, :math:\\)hat{F}_{XL}` \uc758 \uccab \ubc88\uc9f8 \uc904\uc740 \ubca1\ud130\ud654\ub41c \ud2b9\uc9d5 \ub9f5 \\(F_{XL}^1\\) \uc5d0 \ud574\ub2f9\ud569\ub2c8\ub2e4. \ub9c8\uc9c0\ub9c9\uc73c\ub85c, gram \ud589\ub82c\uc740 \ud589\ub82c\uc5d0\uc11c \uac01 \uac12\uc744 \uac12\uc758 \ucd1d \uac1c\uc218\ub85c \ub098\ub204\uc5b4 \uc815\uaddc\ud654 \ud574\uc57c \ud569\ub2c8\ub2e4. \uc815\uaddc\ud654\ub294 \ud070 \\(N\\) \ucc28\uc6d0\uc744 \uac00\uc9c0\ub294 \\(\\hat{F}_{XL}\\) \ud589\ub82c\uc774 gram \ud589\ub82c\uc5d0\uc11c \ub354 \ud070 \uac12\uc744 \uc0dd\uc131\ud55c\ub2e4\ub294 \uc0ac\uc2e4\uc5d0 \ub300\uc751\ud558\uae30 \uc704\ud55c \uac83\uc785\ub2c8\ub2e4. \uc774\uc640 \uac19\uc740 \ub354 \ud070 \uac12\uc740 \uccab \ubc88\uc9f8 \uacc4\uce35(\ud480\ub9c1 \uacc4\uce35 \uc804)\uc774 \uacbd\uc0ac \ud558\uac15 \uc911\uc5d0 \ub354 \ud070 \uc601\ud5a5\uc744 \ubbf8\uce58\uac8c\ud569\ub2c8\ub2e4. Style \ud2b9\uc9d5\uc740 \ub124\ud2b8\uc6cc\ud06c\uc758 \uae4a\uc740 \uacc4\uce35\uc5d0 \uc788\ub294 \uacbd\ud5a5\uc774 \uc788\uae30\uc5d0 \uc815\uaddc\ud654 \ub2e8\uacc4\uac00 \uc911\uc694\ud569\ub2c8\ub2e4. def gram_matrix(input): a, b, c, d = input.size() # a=\ubc30\uce58 \ud06c\uae30(=1) # b=\ud2b9\uc9d5 \ub9f5\uc758 \uc218 # (c,d)=\ud2b9\uc9d5 \ub9f5\uc758 \ucc28\uc6d0 (N=c*d) features = input.view(a * b, c * d) # F_XL\uc744 \\hat F_XL\ub85c \ud06c\uae30 \uc870\uc815 G = torch.mm(features, features.t()) # gram product\ub97c \uacc4\uc0b0 # \uac01 \ud2b9\uc9d5 \ub9f5\uc774 \uac16\ub294 \uac12\uc758 \uc218\ub85c \ub098\ub204\uc5b4 # gram \ud589\ub82c\uc758 \uac12\uc744 \u0027\uc815\uaddc\ud654\u0027 return G.div(a * b * c * d) \uc774\uc81c Style \uc190\uc2e4 \ubaa8\ub4c8\uc740 Content \uc190\uc2e4 \ubaa8\ub4c8\uacfc \uac70\uc758 \ub611\uac19\uc544 \ubcf4\uc785\ub2c8\ub2e4. Style \uac70\ub9ac\ub294 \\(G_{XL}\\) \uc640 \\(G_{SL}\\) \uc0ac\uc774\uc758 \ud3c9\uade0 \uc81c\uacf1 \uc624\ucc28\ub97c \uc0ac\uc6a9\ud574 \uacc4\uc0b0\ub429\ub2c8\ub2e4. class StyleLoss(nn.Module): def __init__(self, target_feature): super(StyleLoss, self).__init__() self.target = gram_matrix(target_feature).detach() def forward(self, input): G = gram_matrix(input) self.loss = F.mse_loss(G, self.target) return input \ubaa8\ub378 \uac00\uc838\uc624\uae30# \uc774\uc81c\ub294 \uc0ac\uc804 \ud6c8\ub828\ub41c \uc2e0\uacbd\ub9dd\uc744 \uac00\uc838\uc640\uc57c \ud569\ub2c8\ub2e4. \ub17c\ubb38\uc5d0\uc11c \uc0ac\uc6a9\ub41c \uac83\uacfc \uac19\uc774 19 \uacc4\uce35\uc744 \uac00\uc9c4 VGG \ub124\ud2b8\uc6cc\ud06c\ub97c \uc0ac\uc6a9\ud560 \uac83\uc785\ub2c8\ub2e4. PyTorch\uc758 VGG \uad6c\ud604\uc740 features (\ud569\uc131\uacf1 \ubc0f \ud480\ub9c1 \uacc4\uce35 \ud3ec\ud568) \uc640 classifier (\uc644\uc804 \uc5f0\uacb0 \uacc4\uce35 \ud3ec\ud568) \ub450 \uac00\uc9c0 \ud558\uc704 Sequential \ubaa8\ub4c8\ub85c \uad6c\ubd84 \ub41c \ubaa8\ub4c8\uc785\ub2c8\ub2e4. Content \ubc0f Style \uc190\uc2e4\uc744 \uce21\uc815\ud558\uae30 \uc704\ud574\uc11c \uac01 \ud569\uc131\uacf1 \uacc4\uce35\uc758 \ucd9c\ub825\uc774 \ud544\uc694\ud558\uae30 \ub54c\ubb38\uc5d0 features \ubaa8\ub4c8\uc744 \uc0ac\uc6a9\ud560 \uac83\uc785\ub2c8\ub2e4. \uc77c\ubd80 \uacc4\uce35\uc740 \ud6c8\ub828\ud558\ub294 \uc911 \ud3c9\uac00\uc640 \ub2e4\ub978 \ub3d9\uc791\uc744 \ud558\ubbc0\ub85c, \ub124\ud2b8\uc6cc\ud06c\ub97c .eval() \ub97c \uc0ac\uc6a9\ud574 \ud3c9\uac00 \ubaa8\ub4dc\ub85c \uc124\uc815\ud574\uc57c\ud569\ub2c8\ub2e4. cnn = vgg19(weights=VGG19_Weights.DEFAULT).features.eval() Downloading: \"https://download.pytorch.org/models/vgg19-dcbb9e9d.pth\" to /root/.cache/torch/hub/checkpoints/vgg19-dcbb9e9d.pth 0%| | 0.00/548M [00:00\u003c?, ?B/s] 2%|\u258f | 8.50M/548M [00:00\u003c00:06, 88.9MB/s] 4%|\u258e | 20.1M/548M [00:00\u003c00:05, 108MB/s] 6%|\u258c | 31.6M/548M [00:00\u003c00:04, 110MB/s] 8%|\u258a | 42.9M/548M [00:00\u003c00:04, 113MB/s] 10%|\u2589 | 54.2M/548M [00:00\u003c00:04, 115MB/s] 12%|\u2588\u258f | 65.4M/548M [00:00\u003c00:04, 115MB/s] 14%|\u2588\u258d | 76.6M/548M [00:00\u003c00:04, 116MB/s] 16%|\u2588\u258c | 88.0M/548M [00:00\u003c00:04, 117MB/s] 18%|\u2588\u258a | 99.5M/548M [00:00\u003c00:04, 116MB/s] 20%|\u2588\u2588 | 112M/548M [00:01\u003c00:03, 120MB/s] 23%|\u2588\u2588\u258e | 123M/548M [00:01\u003c00:03, 119MB/s] 25%|\u2588\u2588\u258d | 135M/548M [00:01\u003c00:03, 117MB/s] 27%|\u2588\u2588\u258b | 146M/548M [00:01\u003c00:03, 119MB/s] 29%|\u2588\u2588\u2589 | 158M/548M [00:01\u003c00:03, 118MB/s] 31%|\u2588\u2588\u2588 | 169M/548M [00:01\u003c00:03, 118MB/s] 33%|\u2588\u2588\u2588\u258e | 180M/548M [00:01\u003c00:03, 116MB/s] 35%|\u2588\u2588\u2588\u258d | 192M/548M [00:01\u003c00:03, 117MB/s] 37%|\u2588\u2588\u2588\u258b | 203M/548M [00:01\u003c00:03, 117MB/s] 39%|\u2588\u2588\u2588\u2589 | 214M/548M [00:01\u003c00:02, 117MB/s] 41%|\u2588\u2588\u2588\u2588 | 226M/548M [00:02\u003c00:02, 117MB/s] 43%|\u2588\u2588\u2588\u2588\u258e | 237M/548M [00:02\u003c00:02, 117MB/s] 45%|\u2588\u2588\u2588\u2588\u258c | 248M/548M [00:02\u003c00:02, 117MB/s] 47%|\u2588\u2588\u2588\u2588\u258b | 259M/548M [00:02\u003c00:02, 117MB/s] 49%|\u2588\u2588\u2588\u2588\u2589 | 270M/548M [00:02\u003c00:02, 117MB/s] 51%|\u2588\u2588\u2588\u2588\u2588\u258f | 282M/548M [00:02\u003c00:02, 117MB/s] 53%|\u2588\u2588\u2588\u2588\u2588\u258e | 293M/548M [00:02\u003c00:02, 117MB/s] 56%|\u2588\u2588\u2588\u2588\u2588\u258c | 304M/548M [00:02\u003c00:02, 117MB/s] 58%|\u2588\u2588\u2588\u2588\u2588\u258a | 316M/548M [00:02\u003c00:02, 117MB/s] 60%|\u2588\u2588\u2588\u2588\u2588\u2589 | 327M/548M [00:02\u003c00:01, 117MB/s] 62%|\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 338M/548M [00:03\u003c00:01, 117MB/s] 64%|\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 349M/548M [00:03\u003c00:01, 116MB/s] 66%|\u2588\u2588\u2588\u2588\u2588\u2588\u258c | 361M/548M [00:03\u003c00:01, 118MB/s] 68%|\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 372M/548M [00:03\u003c00:01, 117MB/s] 70%|\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 383M/548M [00:03\u003c00:01, 114MB/s] 72%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 396M/548M [00:03\u003c00:01, 118MB/s] 74%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 407M/548M [00:03\u003c00:01, 117MB/s] 76%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 418M/548M [00:03\u003c00:01, 118MB/s] 78%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 430M/548M [00:03\u003c00:01, 118MB/s] 80%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 441M/548M [00:03\u003c00:00, 117MB/s] 82%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f | 452M/548M [00:04\u003c00:00, 115MB/s] 85%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d | 464M/548M [00:04\u003c00:00, 118MB/s] 87%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b | 476M/548M [00:04\u003c00:00, 116MB/s] 89%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589 | 487M/548M [00:04\u003c00:00, 115MB/s] 91%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 498M/548M [00:04\u003c00:00, 115MB/s] 93%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e| 510M/548M [00:04\u003c00:00, 119MB/s] 95%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c| 522M/548M [00:04\u003c00:00, 115MB/s] 97%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b| 534M/548M [00:04\u003c00:00, 119MB/s] 99%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589| 545M/548M [00:04\u003c00:00, 116MB/s] 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 548M/548M [00:04\u003c00:00, 117MB/s] \ucd94\uac00\uc801\uc73c\ub85c, VGG \ub124\ud2b8\uc6cc\ud06c\ub294 mean=[0.485, 0.456, 0.406] \uc640 std=[0.229, 0.224, 0.225]\ub85c \uac01 \ucc44\ub110\uc774 \uc815\uaddc\ud654 \ub41c \uc774\ubbf8\uc9c0\ub85c \ud6c8\ub828\ub429\ub2c8\ub2e4. \uc774\ubbf8\uc9c0\ub97c \ub124\ud2b8\uc6cc\ud06c\ub85c \uc785\ub825\ud558\uae30 \uc804\uc5d0 \uc815\uaddc\ud654\ud558\ub294\ub370 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. cnn_normalization_mean = torch.tensor([0.485, 0.456, 0.406]) cnn_normalization_std = torch.tensor([0.229, 0.224, 0.225]) # \uc785\ub825 \uc774\ubbf8\uc9c0\ub97c \uc815\uaddc\ud654\ud558\ub294 \ubaa8\ub4c8\uc744 \uc0dd\uc131\ud558\uc5ec \uc27d\uac8c ``nn.Sequential`` \uc5d0 \ub123\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. class Normalization(nn.Module): def __init__(self, mean, std): super(Normalization, self).__init__() # .view \ub294 mean\uacfc std\uc744 \ud655\uc778\ud574 [B x C x H x W] \ud615\ud0dc\uc758 # \uc774\ubbf8\uc9c0 \ud150\uc11c\ub97c \uc9c1\uc811\uc801\uc73c\ub85c \uc791\uc5c5\ud560 \uc218 \uc788\ub3c4\ub85d [C x 1 x 1] \ud615\ud0dc\ub85c \ub9cc\ub4ed\ub2c8\ub2e4. # B\ub294 \ubc30\uce58 \ud06c\uae30\uc785\ub2c8\ub2e4. C\ub294 \ucc44\ub110\uc758 \uc218\uc785\ub2c8\ub2e4. H\ub294 \ub192\uc774\uace0 W\ub294 \ub108\ube44\uc785\ub2c8\ub2e4. self.mean = torch.tensor(mean).view(-1, 1, 1) self.std = torch.tensor(std).view(-1, 1, 1) def forward(self, img): # ``img`` \uc815\uaddc\ud654 return (img - self.mean) / self.std Sequential \ubaa8\ub4c8\uc740 \uc21c\uc11c\uac00 \uc788\ub294 \ud558\uc704 \ubaa8\ub4c8\uc758 \ub9ac\uc2a4\ud2b8\uac00 \ud3ec\ud568\ub429\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, vgg19.features \uc740 \uc62c\ubc14\ub978 \uc21c\uc11c\ub85c \uc815\ub82c \ub41c \uc2dc\ud000\uc2a4( Conv2d, ReLU, MaxPool2d, Conv2d, ReLU\u2026)\uac00 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. Content \uc190\uc2e4\uacfc Style \uc190\uc2e4 \uacc4\uce35\uc744 \uac10\uc9c0\ud558\ub294 \ud569\uc131\uacf1 \uacc4\uce35 \ubc14\ub85c \ub4a4\uc5d0 \ucd94\uac00\ud574\uc57c\ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uae30 \uc704\ud574\uc11c\ub294 Content \uc190\uc2e4\uacfc Style \uc190\uc2e4 \ubaa8\ub4c8\uc774 \uc62c\ubc14\ub974\uac8c \uc0bd\uc785\ub41c \uc0c8\ub85c\uc6b4 Sequential \ubaa8\ub4c8\uc744 \ub9cc\ub4e4\uc5b4\uc57c \ud569\ub2c8\ub2e4. # Style / Content \uc190\uc2e4 \uacc4\uc0b0\uc744 \uc6d0\ud558\ub294 \uacc4\uce35 content_layers_default = [\u0027conv_4\u0027] style_layers_default = [\u0027conv_1\u0027, \u0027conv_2\u0027, \u0027conv_3\u0027, \u0027conv_4\u0027, \u0027conv_5\u0027] def get_style_model_and_losses(cnn, normalization_mean, normalization_std, style_img, content_img, content_layers=content_layers_default, style_layers=style_layers_default): # \ubaa8\ub4c8 \uc815\uaddc\ud654 normalization = Normalization(normalization_mean, normalization_std) # Content / Style \uc190\uc2e4\uc774 \ubc18\ubcf5\uc801\uc73c\ub85c \uc811\uadfc\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\uae30 \uc704\ud574 content_losses = [] style_losses = [] # ``cnn`` \uc774 ``nn.Sequential`` \uc774\ub77c\uace0 \uac00\uc815\ud558\uace0, # \uc21c\ucc28\uc801\uc73c\ub85c \ud65c\uc131\ud654\ub418\uc5b4\uc57c \ud558\ub294 \ubaa8\ub4c8\uc5d0 \uc0c8\ub85c\uc6b4 ``nn.Sequential`` \uc744 \ub9cc\ub4ed\ub2c8\ub2e4. model = nn.Sequential(normalization) i = 0 # conv\ub97c \ubcfc \ub54c\ub9c8\ub2e4 \uc99d\uac00 for layer in cnn.children(): if isinstance(layer, nn.Conv2d): i += 1 name = \u0027conv_{}\u0027.format(i) elif isinstance(layer, nn.ReLU): name = \u0027relu_{}\u0027.format(i) # \uc544\ub798\uc5d0 \ucd94\uac00\ud55c ``ContentLoss`` \uc640 ``StyleLoss`` \ub294 in-place \ubc84\uc804\uc5d0\uc11c\ub294 \uc798 \ub3d9\uc791\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. # \uadf8\ub798\uc11c \uc5ec\uae30\uc11c\ub294 out-of-place\ub85c \ub300\uccb4\ud569\ub2c8\ub2e4. layer = nn.ReLU(inplace=False) elif isinstance(layer, nn.MaxPool2d): name = \u0027pool_{}\u0027.format(i) elif isinstance(layer, nn.BatchNorm2d): name = \u0027bn_{}\u0027.format(i) else: raise RuntimeError(\u0027Unrecognized layer: {}\u0027.format(layer.__class__.__name__)) model.add_module(name, layer) if name in content_layers: # Content \uc190\uc2e4 \ucd94\uac00 target = model(content_img).detach() content_loss = ContentLoss(target) model.add_module(\"content_loss_{}\".format(i), content_loss) content_losses.append(content_loss) if name in style_layers: # Style \uc190\uc2e4 \ucd94\uac00 target_feature = model(style_img).detach() style_loss = StyleLoss(target_feature) model.add_module(\"style_loss_{}\".format(i), style_loss) style_losses.append(style_loss) # \uc774\uc81c \ub9c8\uc9c0\ub9c9 Content \ubc0f Style \uc190\uc2e4 \ub4a4\uc5d0 \uacc4\uce35\uc744 \uc798\ub77c\ub0c5\ub2c8\ub2e4. for i in range(len(model) - 1, -1, -1): if isinstance(model[i], ContentLoss) or isinstance(model[i], StyleLoss): break model = model[:(i + 1)] return model, style_losses, content_losses \ub2e4\uc74c\uc73c\ub85c \uc785\ub825 \uc774\ubbf8\uc9c0\ub97c \uc120\ud0dd\ud569\ub2c8\ub2e4. Content \uc774\ubbf8\uc9c0 \uc0ac\ubcf8\uc774\ub098 \ubc31\uc0c9 \uc7a1\uc74c\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. input_img = torch.randn(content_img.data.size()) # \ub9cc\uc57d \ud654\uc774\ud2b8 \ub178\uc774\uc988(white noise)\uc744 \uc0ac\uc6a9\ud558\ub824\uba74 \uc544\ub798 \uc8fc\uc11d\uc744 \uc81c\uac70\ud558\uc138\uc694: # # :: # # input_img = torch.randn(content_img.data.size(), device=device) # \uadf8\ub9bc\uc5d0 \uc6d0\ubcf8 \uc785\ub825 \uc774\ubbf8\uc9c0\ub97c \ucd94\uac00\ud569\ub2c8\ub2e4. plt.figure() imshow(input_img, title=\u0027Input Image\u0027) Traceback (most recent call last): File \"/workspace/tutorials-kr/advanced_source/neural_style_tutorial.py\", line 359, in \u003cmodule\u003e imshow(input_img, title=\u0027Input Image\u0027) ^^^^^^^^^ NameError: name \u0027input_img\u0027 is not defined \uacbd\uc0ac \ud558\uac15\ubc95# \uc54c\uace0\ub9ac\uc998 \uc791\uc131\uc790\uc778 Leon Gatys\uac00 \uc5ec\uae30 \uc5d0\uc11c \uc81c\uc548\ud588\ub358 \uac83\ucc98\ub7fc, L-BFGS \uc54c\uace0\ub9ac\uc998\uc744 \uc0ac\uc6a9\ud558\uc5ec \uacbd\uc0ac \ud558\uac15\ubc95\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c \ud6c8\ub828\uacfc \ub2e4\ub974\uac8c Content / Style \uc190\uc2e4\uc744 \ucd5c\uc18c\ud654\ud558\uae30 \uc704\ud574 \uc785\ub825 \uc774\ubbf8\uc9c0\ub97c \ud6c8\ub828\ud558\ub824\uace0 \ud569\ub2c8\ub2e4. \ud30c\uc774\ud1a0\uce58 L-BFGS optimizer optim.LBFGS \ub97c \ub9cc\ub4e4\uace0 \ucd5c\uc801\ud654 \ud560 \ud150\uc11c\ub85c \uc774\ubbf8\uc9c0\ub97c \uc804\ub2ec\ud569\ub2c8\ub2e4. def get_input_optimizer(input_img): # \uc785\ub825\uc774 \uae30\uc6b8\uae30\uac00 \ud544\uc694\ud55c \ub9e4\uac1c \ubcc0\uc218\uc784\uc744 \ud45c\uc2dc\ud558\ub294 \uc904 optimizer = optim.LBFGS([input_img]) return optimizer \ub9c8\uc9c0\ub9c9\uc73c\ub85c \ub274\ub7f4 \ubcc0\ud658(neural transfer)\uc744 \uc218\ud589\ud558\ub294 \ud568\uc218\ub97c \uc815\uc758\ud574\uc57c \ud569\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c\uc758 \uac01 \ubc18\ubcf5 \ub3d9\uc548, \uc5c5\ub370\uc774\ud2b8\ub41c \uc785\ub825\uc774 \uc8fc\uc5b4\uc9c0\uace0 \uc0c8\ub85c\uc6b4 \uc190\uc2e4\uc744 \uacc4\uc0b0\ud569\ub2c8\ub2e4. \uac01 \uc190\uc2e4 \ubaa8\ub4c8(Loss module)\uc758 backward \uba54\uc18c\ub4dc\ub97c \uc2e4\ud589\ud558\uc5ec \uae30\uc6b8\uae30\ub97c \ub3d9\uc801\uc73c\ub85c \uacc4\uc0b0\ud569\ub2c8\ub2e4. optimizer\ub294 \ubaa8\ub4c8\uc744 \uc7ac\ud3c9\uac00\ud558\uace0 \uc190\uc2e4\uc744 \ubc18\ud658\ud558\ub294 \u201cclosure\u201d \ud568\uc218\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. \uc5ec\uc804\ud788 \ud574\uacb0\ud574\uc57c \ud560 \ub9c8\uc9c0\ub9c9 \uc81c\uc57d\uc774 \uc788\uc2b5\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c\uac00 \uc774\ubbf8\uc9c0\uc5d0 \ub300\ud574 0 ~ 1 \ud150\uc11c \ubc94\uc704\ub97c \ucd08\uacfc\ud558\ub294 \uac12\uc73c\ub85c \ucd5c\uc801\ud654\ud558\ub824 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c\uac00 \uc2e4\ud589\ub420 \ub54c\ub9c8\ub2e4 \uc785\ub825\uac12\uc744 0\uc5d0\uc11c 1\uc0ac\uc774\ub85c \uc218\uc815\ud558\uc5ec \ubb38\uc81c\ub97c \ud574\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. def run_style_transfer(cnn, normalization_mean, normalization_std, content_img, style_img, input_img, num_steps=300, style_weight=1000000, content_weight=1): \"\"\"Run the style transfer.\"\"\" print(\u0027Building the style transfer model..\u0027) model, style_losses, content_losses = get_style_model_and_losses(cnn, normalization_mean, normalization_std, style_img, content_img) # \ubaa8\ub378\uc758 \ub9e4\uac1c\ubcc0\uc218\ub97c \uc81c\uc678\ud55c \uc785\ub825\uc744 \ucd5c\uc801\ud654\ud574\uc57c \ud558\ubbc0\ub85c # \uc774\uc5d0 \ub9de\ucdb0\uc11c requires_grad \uac12\uc744 \uac31\uc2e0\ud569\ub2c8\ub2e4. input_img.requires_grad_(True) # \ub610\ud55c, \ubaa8\ub378\uc744 \ud3c9\uac00(eval) \ubaa8\ub4dc\ub85c \uc804\ud658\ud558\uc5ec # \ub4dc\ub86d\uc544\uc6c3(dropout) \ubc0f \ubc30\uce58 \uc815\uaddc\ud654(batch normalization)\uc640 \uac19\uc740 \ud2b9\uc815 \ub808\uc774\uc5b4\uac00 \uc62c\ubc14\ub974\uac8c \ub3d9\uc791\ud558\ub3c4\ub85d \ud569\ub2c8\ub2e4. model.eval() model.requires_grad_(False) optimizer = get_input_optimizer(input_img) print(\u0027Optimizing..\u0027) run = [0] while run[0] \u003c= num_steps: def closure(): # \uc5c5\ub370\uc774\ud2b8 \ub41c \uc785\ub825 \uc774\ubbf8\uc9c0\uc758 \uac12\uc744 \uc218\uc815 with torch.no_grad(): input_img.clamp_(0, 1) optimizer.zero_grad() model(input_img) style_score = 0 content_score = 0 for sl in style_losses: style_score += sl.loss for cl in content_losses: content_score += cl.loss style_score *= style_weight content_score *= content_weight loss = style_score + content_score loss.backward() run[0] += 1 if run[0] % 50 == 0: print(\"run {}:\".format(run)) print(\u0027Style Loss : {:4f} Content Loss: {:4f}\u0027.format( style_score.item(), content_score.item())) print() return style_score + content_score optimizer.step(closure) # \ub9c8\uc9c0\ub9c9 \uc218\uc815... with torch.no_grad(): input_img.clamp_(0, 1) return input_img \ub9c8\uc9c0\ub9c9\uc73c\ub85c, \uc54c\uace0\ub9ac\uc998\uc744 \uc2e4\ud589\ud569\ub2c8\ub2e4. output = run_style_transfer(cnn, cnn_normalization_mean, cnn_normalization_std, content_img, style_img, input_img) plt.figure() imshow(output, title=\u0027Output Image\u0027) # sphinx_gallery_thumbnail_number = 4 plt.ioff() plt.show() Total running time of the script: (0 minutes 9.832 seconds) Download Jupyter notebook: neural_style_tutorial.ipynb Download Python source code: neural_style_tutorial.py Download zipped: neural_style_tutorial.zip",
       "author": {
         "@type": "Organization",
         "name": "PyTorch Contributors",
         "url": "https://pytorch.org"
       },
       "image": "../_static/img/pytorch_seo.png",
       "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "/advanced/neural_style_tutorial.html"
       },
       "datePublished": "2023-01-01T00:00:00Z",
       "dateModified": "2023-01-01T00:00:00Z"
     }
 </script>
  <script>
    // Tutorials Call to action event tracking
    $("[data-behavior='call-to-action-event']").on('click', function () {
      fbq('trackCustom', "Download", {
        tutorialTitle: $('h1:first').text(),
        downloadLink: this.href,
        tutorialLink: window.location.href,
        downloadTitle: $(this).attr("data-response")
      });
      if (typeof gtag === 'function') {
        gtag('event', 'click', {
          'event_category': $(this).attr("data-response"),
          'event_label': $("h1").first().text(),
          'tutorial_link': window.location.href
        });
      }
    });
  </script>
  
  </body>
</html>